{"version":3,"file":"_tree-key-manager-chunk.mjs","sources":["../../../../../darwin_arm64-fastbuild-ST-199a4f3c4e20/bin/src/cdk/a11y/key-manager/tree-key-manager.ts"],"sourcesContent":["/**\n * @license\n * Copyright Google LLC All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.dev/license\n */\n\nimport {InjectionToken, QueryList} from '@angular/core';\nimport {coerceObservable} from '../../coercion/private';\nimport {Observable, Subject, Subscription, isObservable, of as observableOf} from 'rxjs';\nimport {take} from 'rxjs/operators';\nimport {\n  TreeKeyManagerFactory,\n  TreeKeyManagerItem,\n  TreeKeyManagerOptions,\n  TreeKeyManagerStrategy,\n} from './tree-key-manager-strategy';\nimport {Typeahead} from './typeahead';\n\n/**\n * This class manages keyboard events for trees. If you pass it a QueryList or other list of tree\n * items, it will set the active item, focus, handle expansion and typeahead correctly when\n * keyboard events occur.\n */\nexport class TreeKeyManager<T extends TreeKeyManagerItem> implements TreeKeyManagerStrategy<T> {\n  /** The index of the currently active (focused) item. */\n  private _activeItemIndex = -1;\n  /** The currently active (focused) item. */\n  private _activeItem: T | null = null;\n  /** Whether or not we activate the item when it's focused. */\n  private _shouldActivationFollowFocus = false;\n  /**\n   * The orientation that the tree is laid out in. In `rtl` mode, the behavior of Left and\n   * Right arrow are switched.\n   */\n  private _horizontalOrientation: 'ltr' | 'rtl' = 'ltr';\n\n  /**\n   * Predicate function that can be used to check whether an item should be skipped\n   * by the key manager.\n   *\n   * The default value for this doesn't skip any elements in order to keep tree items focusable\n   * when disabled. This aligns with ARIA guidelines:\n   * https://www.w3.org/WAI/ARIA/apg/practices/keyboard-interface/#focusabilityofdisabledcontrols.\n   */\n  private _skipPredicateFn = (_item: T) => false;\n\n  /** Function to determine equivalent items. */\n  private _trackByFn: (item: T) => unknown = (item: T) => item;\n\n  /** Synchronous cache of the items to manage. */\n  private _items: T[] = [];\n\n  private _typeahead?: Typeahead<T>;\n  private _typeaheadSubscription = Subscription.EMPTY;\n\n  private _hasInitialFocused = false;\n\n  private _initializeFocus(): void {\n    if (this._hasInitialFocused || this._items.length === 0) {\n      return;\n    }\n\n    let activeIndex = 0;\n    for (let i = 0; i < this._items.length; i++) {\n      if (!this._skipPredicateFn(this._items[i]) && !this._isItemDisabled(this._items[i])) {\n        activeIndex = i;\n        break;\n      }\n    }\n\n    const activeItem = this._items[activeIndex];\n\n    // Use `makeFocusable` here, because we want the item to just be focusable, not actually\n    // capture the focus since the user isn't interacting with it. See #29628.\n    if (activeItem.makeFocusable) {\n      this._activeItem?.unfocus();\n      this._activeItemIndex = activeIndex;\n      this._activeItem = activeItem;\n      this._typeahead?.setCurrentSelectedItemIndex(activeIndex);\n      activeItem.makeFocusable();\n    } else {\n      // Backwards compatibility for items that don't implement `makeFocusable`.\n      this.focusItem(activeIndex);\n    }\n\n    this._hasInitialFocused = true;\n  }\n\n  /**\n   *\n   * @param items List of TreeKeyManager options. Can be synchronous or asynchronous.\n   * @param config Optional configuration options. By default, use 'ltr' horizontal orientation. By\n   * default, do not skip any nodes. By default, key manager only calls `focus` method when items\n   * are focused and does not call `activate`. If `typeaheadDefaultInterval` is `true`, use a\n   * default interval of 200ms.\n   */\n  constructor(items: Observable<T[]> | QueryList<T> | T[], config: TreeKeyManagerOptions<T>) {\n    // We allow for the items to be an array or Observable because, in some cases, the consumer may\n    // not have access to a QueryList of the items they want to manage (e.g. when the\n    // items aren't being collected via `ViewChildren` or `ContentChildren`).\n    if (items instanceof QueryList) {\n      this._items = items.toArray();\n      items.changes.subscribe((newItems: QueryList<T>) => {\n        this._items = newItems.toArray();\n        this._typeahead?.setItems(this._items);\n        this._updateActiveItemIndex(this._items);\n        this._initializeFocus();\n      });\n    } else if (isObservable(items)) {\n      items.subscribe(newItems => {\n        this._items = newItems;\n        this._typeahead?.setItems(newItems);\n        this._updateActiveItemIndex(newItems);\n        this._initializeFocus();\n      });\n    } else {\n      this._items = items;\n      this._initializeFocus();\n    }\n\n    if (typeof config.shouldActivationFollowFocus === 'boolean') {\n      this._shouldActivationFollowFocus = config.shouldActivationFollowFocus;\n    }\n    if (config.horizontalOrientation) {\n      this._horizontalOrientation = config.horizontalOrientation;\n    }\n    if (config.skipPredicate) {\n      this._skipPredicateFn = config.skipPredicate;\n    }\n    if (config.trackBy) {\n      this._trackByFn = config.trackBy;\n    }\n    if (typeof config.typeAheadDebounceInterval !== 'undefined') {\n      this._setTypeAhead(config.typeAheadDebounceInterval);\n    }\n  }\n\n  /** Stream that emits any time the focused item changes. */\n  readonly change = new Subject<T | null>();\n\n  /** Cleans up the key manager. */\n  destroy() {\n    this._typeaheadSubscription.unsubscribe();\n    this._typeahead?.destroy();\n    this.change.complete();\n  }\n\n  /**\n   * Handles a keyboard event on the tree.\n   * @param event Keyboard event that represents the user interaction with the tree.\n   */\n  onKeydown(event: KeyboardEvent) {\n    const key = event.key;\n\n    switch (key) {\n      case 'Tab':\n        // Return early here, in order to allow Tab to actually tab out of the tree\n        return;\n\n      case 'ArrowDown':\n        this._focusNextItem();\n        break;\n\n      case 'ArrowUp':\n        this._focusPreviousItem();\n        break;\n\n      case 'ArrowRight':\n        this._horizontalOrientation === 'rtl'\n          ? this._collapseCurrentItem()\n          : this._expandCurrentItem();\n        break;\n\n      case 'ArrowLeft':\n        this._horizontalOrientation === 'rtl'\n          ? this._expandCurrentItem()\n          : this._collapseCurrentItem();\n        break;\n\n      case 'Home':\n        this._focusFirstItem();\n        break;\n\n      case 'End':\n        this._focusLastItem();\n        break;\n\n      case 'Enter':\n      case ' ':\n        this._activateCurrentItem();\n        break;\n\n      default:\n        if (event.key === '*') {\n          this._expandAllItemsAtCurrentItemLevel();\n          break;\n        }\n\n        this._typeahead?.handleKey(event);\n        // Return here, in order to avoid preventing the default action of non-navigational\n        // keys or resetting the buffer of pressed letters.\n        return;\n    }\n\n    // Reset the typeahead since the user has used a navigational key.\n    this._typeahead?.reset();\n    event.preventDefault();\n  }\n\n  /** Index of the currently active item. */\n  getActiveItemIndex(): number | null {\n    return this._activeItemIndex;\n  }\n\n  /** The currently active item. */\n  getActiveItem(): T | null {\n    return this._activeItem;\n  }\n\n  /** Focus the first available item. */\n  private _focusFirstItem(): void {\n    this.focusItem(this._findNextAvailableItemIndex(-1));\n  }\n\n  /** Focus the last available item. */\n  private _focusLastItem(): void {\n    this.focusItem(this._findPreviousAvailableItemIndex(this._items.length));\n  }\n\n  /** Focus the next available item. */\n  private _focusNextItem(): void {\n    this.focusItem(this._findNextAvailableItemIndex(this._activeItemIndex));\n  }\n\n  /** Focus the previous available item. */\n  private _focusPreviousItem(): void {\n    this.focusItem(this._findPreviousAvailableItemIndex(this._activeItemIndex));\n  }\n\n  /**\n   * Focus the provided item by index.\n   * @param index The index of the item to focus.\n   * @param options Additional focusing options.\n   */\n  focusItem(index: number, options?: {emitChangeEvent?: boolean}): void;\n  focusItem(item: T, options?: {emitChangeEvent?: boolean}): void;\n  focusItem(itemOrIndex: number | T, options?: {emitChangeEvent?: boolean}): void;\n  focusItem(itemOrIndex: number | T, options: {emitChangeEvent?: boolean} = {}) {\n    // Set default options\n    options.emitChangeEvent ??= true;\n\n    let index =\n      typeof itemOrIndex === 'number'\n        ? itemOrIndex\n        : this._items.findIndex(item => this._trackByFn(item) === this._trackByFn(itemOrIndex));\n    if (index < 0 || index >= this._items.length) {\n      return;\n    }\n    const activeItem = this._items[index];\n\n    // If we're just setting the same item, don't re-call activate or focus\n    if (\n      this._activeItem !== null &&\n      this._trackByFn(activeItem) === this._trackByFn(this._activeItem)\n    ) {\n      return;\n    }\n\n    const previousActiveItem = this._activeItem;\n    this._activeItem = activeItem ?? null;\n    this._activeItemIndex = index;\n    this._typeahead?.setCurrentSelectedItemIndex(index);\n\n    this._activeItem?.focus();\n    previousActiveItem?.unfocus();\n\n    if (options.emitChangeEvent) {\n      this.change.next(this._activeItem);\n    }\n\n    if (this._shouldActivationFollowFocus) {\n      this._activateCurrentItem();\n    }\n  }\n\n  private _updateActiveItemIndex(newItems: T[]) {\n    const activeItem = this._activeItem;\n    if (!activeItem) {\n      return;\n    }\n\n    const newIndex = newItems.findIndex(\n      item => this._trackByFn(item) === this._trackByFn(activeItem),\n    );\n\n    if (newIndex > -1 && newIndex !== this._activeItemIndex) {\n      this._activeItemIndex = newIndex;\n      this._typeahead?.setCurrentSelectedItemIndex(newIndex);\n    }\n  }\n\n  private _setTypeAhead(debounceInterval: number | boolean) {\n    this._typeahead = new Typeahead(this._items, {\n      debounceInterval: typeof debounceInterval === 'number' ? debounceInterval : undefined,\n      skipPredicate: item => this._skipPredicateFn(item),\n    });\n\n    this._typeaheadSubscription = this._typeahead.selectedItem.subscribe(item => {\n      this.focusItem(item);\n    });\n  }\n\n  private _findNextAvailableItemIndex(startingIndex: number) {\n    for (let i = startingIndex + 1; i < this._items.length; i++) {\n      if (!this._skipPredicateFn(this._items[i])) {\n        return i;\n      }\n    }\n    return startingIndex;\n  }\n\n  private _findPreviousAvailableItemIndex(startingIndex: number) {\n    for (let i = startingIndex - 1; i >= 0; i--) {\n      if (!this._skipPredicateFn(this._items[i])) {\n        return i;\n      }\n    }\n    return startingIndex;\n  }\n\n  /**\n   * If the item is already expanded, we collapse the item. Otherwise, we will focus the parent.\n   */\n  private _collapseCurrentItem() {\n    if (!this._activeItem) {\n      return;\n    }\n\n    if (this._isCurrentItemExpanded()) {\n      this._activeItem.collapse();\n    } else {\n      const parent = this._activeItem.getParent();\n      if (!parent || this._skipPredicateFn(parent as T)) {\n        return;\n      }\n      this.focusItem(parent as T);\n    }\n  }\n\n  /**\n   * If the item is already collapsed, we expand the item. Otherwise, we will focus the first child.\n   */\n  private _expandCurrentItem() {\n    if (!this._activeItem) {\n      return;\n    }\n\n    if (!this._isCurrentItemExpanded()) {\n      this._activeItem.expand();\n    } else {\n      coerceObservable(this._activeItem.getChildren())\n        .pipe(take(1))\n        .subscribe(children => {\n          const firstChild = children.find(child => !this._skipPredicateFn(child as T));\n          if (!firstChild) {\n            return;\n          }\n          this.focusItem(firstChild as T);\n        });\n    }\n  }\n\n  private _isCurrentItemExpanded() {\n    if (!this._activeItem) {\n      return false;\n    }\n    return typeof this._activeItem.isExpanded === 'boolean'\n      ? this._activeItem.isExpanded\n      : this._activeItem.isExpanded();\n  }\n\n  private _isItemDisabled(item: TreeKeyManagerItem) {\n    return typeof item.isDisabled === 'boolean' ? item.isDisabled : item.isDisabled?.();\n  }\n\n  /** For all items that are the same level as the current item, we expand those items. */\n  private _expandAllItemsAtCurrentItemLevel() {\n    if (!this._activeItem) {\n      return;\n    }\n\n    const parent = this._activeItem.getParent();\n    let itemsToExpand;\n    if (!parent) {\n      itemsToExpand = observableOf(this._items.filter(item => item.getParent() === null));\n    } else {\n      itemsToExpand = coerceObservable(parent.getChildren());\n    }\n\n    itemsToExpand.pipe(take(1)).subscribe(items => {\n      for (const item of items) {\n        item.expand();\n      }\n    });\n  }\n\n  private _activateCurrentItem() {\n    this._activeItem?.activate();\n  }\n}\n\n/** Injection token that determines the key manager to use. */\nexport const TREE_KEY_MANAGER = new InjectionToken<TreeKeyManagerFactory<any>>('tree-key-manager', {\n  providedIn: 'root',\n  factory: () => (items, options) => new TreeKeyManager(items, options),\n});\n"],"names":["TreeKeyManager","_activeItemIndex","_activeItem","_shouldActivationFollowFocus","_horizontalOrientation","_skipPredicateFn","_item","_trackByFn","item","_items","_typeahead","_typeaheadSubscription","Subscription","EMPTY","_hasInitialFocused","_initializeFocus","length","activeIndex","i","_isItemDisabled","activeItem","makeFocusable","unfocus","setCurrentSelectedItemIndex","focusItem","constructor","items","config","QueryList","toArray","changes","subscribe","newItems","setItems","_updateActiveItemIndex","isObservable","shouldActivationFollowFocus","horizontalOrientation","skipPredicate","trackBy","typeAheadDebounceInterval","_setTypeAhead","change","Subject","destroy","unsubscribe","complete","onKeydown","event","key","_focusNextItem","_focusPreviousItem","_collapseCurrentItem","_expandCurrentItem","_focusFirstItem","_focusLastItem","_activateCurrentItem","_expandAllItemsAtCurrentItemLevel","handleKey","reset","preventDefault","getActiveItemIndex","getActiveItem","_findNextAvailableItemIndex","_findPreviousAvailableItemIndex","itemOrIndex","options","emitChangeEvent","index","findIndex","previousActiveItem","focus","next","newIndex","debounceInterval","Typeahead","undefined","selectedItem","startingIndex","_isCurrentItemExpanded","collapse","parent","getParent","expand","coerceObservable","getChildren","pipe","take","children","firstChild","find","child","isExpanded","isDisabled","itemsToExpand","observableOf","filter","activate","TREE_KEY_MANAGER","InjectionToken","providedIn","factory"],"mappings":"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"}