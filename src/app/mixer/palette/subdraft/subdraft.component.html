<div id="con-{{draft.id}}" class="subdraft-container" [class.is_preview] = "is_preview"
	cdkDrag
	[style.z-index] = "zndx"
	[class.drawing] = "disable_drag && !is_preview"
	[class.no-pointer] = "disable_drag"
	[cdkDragDisabled] = "disable_drag"
	[cdkDragFreeDragPosition]="bounds.topleft"
	[cdkDragData]="scale"
	(cdkDragMoved)="dragMove($event)"
	(cdkDragEnded)="dragEnd($event)"
	(cdkDragStarted)="dragStart($event)">



  	<div class="subdraft-contents" [class.active-selection] = has_active_selection>

		
		<canvas id="{{id}}" class="maindraft">  
		</canvas>

		<div class="bottom-opts">
		
		<ng-container *ngIf="set_connectable">
			<button matTooltip = "click here to use this draft as input"
			class="button is-small is-primary"
			[class.is-active]="active_connection_order > 0"
			(click) = "connectionClicked(id)"
			>
			<i class="fas fa-chevron-down"></i>
			<ng-container *ngIf="active_connection_order > 0">{{active_connection_order}}</ng-container>
			</button>
		</ng-container>

		<span> {{draft.warps}} x {{draft.wefts}}</span>
		
		
		
	 </div>
	</div>

	<div class="subdraft-details" [class.hide]="set_connectable"> 
		<div class ="align-top">
		
		<ng-container *ngIf="parent_id === -1">

		<button 
			matTooltip= "Open Options"
			class="button is-small is-primary fas fa-bars"
			[matMenuTriggerFor]="options"
			xPosition="after">
		</button>

		<mat-menu #options="matMenu">

			<!-- hide these options on autogenerated drafts -->
			<ng-container *ngIf="parent_id === -1">
			<!-- <button 
			matTooltip= "Inks"
			class="button is-small is-primary fas fa-tint"
			xPosition="after">
			</button> -->

				<h3 mat-menu-item >Inks</h3>
				<ng-container *ngFor="let i of inks.getInks()">
					<button 
						mat-menu-item
						[matTooltip]=i.dx
						[name]=i.viewValue 
						[class.is-active]=i.selected
						(click)="inkActionChange(i.value)">
						{{i.viewValue}}
				</button> 
				</ng-container> 
				
				<h3 mat-menu-item>Actions</h3>
				<!-- <button 
				matTooltip= "Actions"
				class="button is-small is-primary fas fa-magic"
				[style.color]="button_color" 
				[matMenuTriggerFor]="actions">
				</button>	 -->
			
				<ng-container *ngFor="let class of ops.classification">

					<ng-container *ngFor="let op of class.ops">

						<ng-container *ngIf="op.params.length == 0 && op.max_inputs === 1">

						<button [matTooltip]=op.dx 
						mat-menu-item
						[name]=op.name 
						(click)="designActionChange(op.name)">
						{{op.name}}
						</button>  
						</ng-container>
					</ng-container>  
				</ng-container>


				<!-- <button 
				matTooltip= "Fill Black Cells With..."
				class="button is-small is-primary fas fa-fill"
				[style.color]="button_color" 
				[matMenuTriggerFor]="fills">
				</button>
			
				<mat-menu #fills="matMenu">
					<ng-container *ngFor="let pattern of patterns">
						<ng-container *ngIf="pattern.favorite">
							<button [matTooltip]=pattern.name 
							mat-menu-item
							[name]=pattern.name 
							(click)="fill(pattern.id)">{{pattern.name }}
							</button>  
						</ng-container>  
					</ng-container>
				</mat-menu> -->
		
			</ng-container>
		</mat-menu>

		</ng-container>


		<button 
		matTooltip= "Duplilcate"
		class="button is-small is-primary fa fa-clone"
		[style.color]="button_color" 
		[name]="delete"
		(click)="designActionChange('duplicate')">
		</button>
		
		<button
		[matMenuTriggerFor]="downloadDropdown"
		class="button is-small is-primary fas fa-download"
		 matTooltip ="download this draft">
		</button>


		  <mat-menu #downloadDropdown mat-raised-button>
			<a class="print-link" #printLink (click)="saveAsPrint($event)" mat-menu-item>as Printable Image</a>
			<a #bmpLink (click)="saveAsBmp($event)" mat-menu-item> as Bitmap</a>
			<a #adaLink (click)="saveAsAda($event)" mat-menu-item> as AdaCAD file</a>
			<a #wifLink (click)="saveAsWif($event)" mat-menu-item> as Wif file</a>
		  </mat-menu>
		
		</div>
		<div class="align-bottom">
			<button 
			matTooltip= "Delete"
			class="button is-small is-primary fas fa-times"
			[style.color]="button_color" 
			[name]="delete"
			(click)="designActionChange('delete')">
			</button>
		</div>
	
	
   </div>

   <canvas #bitmapImage hidden></canvas>

</div>
	

