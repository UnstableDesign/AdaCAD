<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>adacad documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	    <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">adacad documentation</a>
            <button type="button" class="btn btn-default btn-menu fa fa-bars" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
            <div id="book-search-input" role="search">
                <input type="text" placeholder="Type to search">
            </div>
            <nav>
            
                <ul class="list">
            
                    <li class="title">
                        <a href="../">adacad documentation</a>
                    </li>
            
                    <li class="divider"></li>
            
            
                    <li class="chapter">
                        <a data-type="chapter-link" href="../"><span class="fa fa-home"></span>Getting started</a>
                        <ul class="links">
                                <li class="link">
                                    <a href="../" ><span class="fa fa-file-text-o"></span>README</a>
                                </li>
                                <li class="link">
                                    <a 
                                        
                                         href="../overview.html" 
                                         href="../overview.html" 
                                        >
                                        <span class="fa fa-th"></span>Overview
                                    </a>
                                </li>
                        </ul>
                    </li>
            
                    <li class="chapter">
                        <a data-type="chapter-link" href="./modules.html" >
                            <span class="fa fa-archive"></span>
                            <span>Modules</span>
                            <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                    data-target="#xs-modules-links"
                            ></span>
                        </a>
                        <ul class="links collapse in"
                                id="xs-modules-links"
                            >
                                <li class="link">
                                    <a href="../modules/AppModule.html" >AppModule</a>
                                </li>
                                <li class="link">
                                    <a href="../modules/AppRoutingModule.html" >AppRoutingModule</a>
                                </li>
                                <li class="link">
                                    <a href="../modules/CoreModule.html" >CoreModule</a>
                                </li>
                                <li class="link">
                                    <a href="../modules/DraftDetailModule.html" >DraftDetailModule</a>
                                </li>
                                <li class="link">
                                    <a href="../modules/MixerModule.html" >MixerModule</a>
                                </li>
                        </ul>
                    </li>
            
                    <li class="chapter">
                        <div class="simple">
                            <span class="fa fa-cogs"></span>
                            <span>Components</span>
                            <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                    data-target="#xs-components-links"
                                ></span>
                        </div>
                        <ul class="links collapse in"
                                id="xs-components-links"
                            >
                                <li class="link">
                                    <a href="../components/AboutModal.html" >AboutModal</a>
                                </li>
                                <li class="link">
                                    <a href="../components/ActionsComponent.html" >ActionsComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/AppComponent.html" >AppComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/BlankdraftModal.html" >BlankdraftModal</a>
                                </li>
                                <li class="link">
                                    <a href="../components/ConnectionComponent.html" >ConnectionComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/CrosssectionComponent.html" >CrosssectionComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/DesignComponent.html" >DesignComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/DraftDetailComponent.html" >DraftDetailComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/DraftviewerComponent.html" >DraftviewerComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/ExamplesComponent.html" >ExamplesComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/FilebrowserComponent.html" >FilebrowserComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/ImageComponent.html" >ImageComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/InitModal.html" >InitModal</a>
                                </li>
                                <li class="link">
                                    <a href="../components/InletComponent.html" >InletComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/LoadfileComponent.html" >LoadfileComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/LoginComponent.html" >LoginComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/LoomModal.html" >LoomModal</a>
                                </li>
                                <li class="link">
                                    <a href="../components/MaterialModal.html" >MaterialModal</a>
                                </li>
                                <li class="link">
                                    <a href="../components/MaterialsComponent.html" >MaterialsComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/MixerComponent.html" >MixerComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/MixerViewComponent.html" >MixerViewComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/NoteComponent.html" >NoteComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/OpHelpModal.html" >OpHelpModal</a>
                                </li>
                                <li class="link">
                                    <a href="../components/OperationComponent.html" >OperationComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/OpsComponent.html" >OpsComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/PaletteComponent.html"  class="active" >PaletteComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/ParameterComponent.html" >ParameterComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/ProfileComponent.html" >ProfileComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/QuickopComponent.html" >QuickopComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/SelectionComponent.html" >SelectionComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/SidebarComponent.html" >SidebarComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/SignupComponent.html" >SignupComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/SimulationComponent.html" >SimulationComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/SnackbarComponent.html" >SnackbarComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/SubdraftComponent.html" >SubdraftComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/SystemsComponent.html" >SystemsComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/TopbarComponent.html" >TopbarComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/UploadFormComponent.html" >UploadFormComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../components/WeaverViewComponent.html" >WeaverViewComponent</a>
                                </li>
                        </ul>
                    </li>
            
                    <li class="chapter">
                        <div class="simple">
                            <span class="fa fa-code"></span>
                            <span>Directives</span>
                            <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                    data-target="#xs-directives-links"
                                ></span>
                        </div>
                        <ul class="links collapse in"
                                id="xs-directives-links"
                            >
                                <li class="link">
                                    <a href="../directives/KeycodesDirective.html" >KeycodesDirective</a>
                                </li>
                                <li class="link">
                                    <a href="../directives/MarqueeComponent.html" >MarqueeComponent</a>
                                </li>
                                <li class="link">
                                    <a href="../directives/SelectionComponent.html" >SelectionComponent</a>
                                </li>
                        </ul>
                    </li>
            
                    <li class="chapter">
                        <div class="simple">
                            <span class="fa fa-file-code-o"></span>
                            <span>Classes</span>
                            <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                    data-target="#xs-classes-links"
                                ></span>
                        </div>
                        <ul class="links collapse in"
                                id="xs-classes-links"
                            >
                                <li class="link">
                                    <a href="../classes/AdaCADWeaverPage.html" >AdaCADWeaverPage</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/MyErrorStateMatcher.html" >MyErrorStateMatcher</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/Selection.html" >Selection</a>
                                </li>
                                <li class="link">
                                    <a href="../classes/Util.html" >Util</a>
                                </li>
                        </ul>
                    </li>
            
                    <li class="chapter">
                        <a data-type="chapter-link" href="../routes.html" ><span class="fa fa-code-fork"></span>Routes</a>
                    </li>
            
                    <li class="chapter">
                        <div class="simple">
                            <span class="fa fa-long-arrow-down"></span>
                            <span>Injectables</span>
                            <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                    data-target="#xs-injectables-links"
                                ></span>
                        </div>
                        <ul class="links collapse in"
                                id="xs-injectables-links"
                            >
                                <li class="link">
                                    <a href="../injectables/AuthService.html" >AuthService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/CollectionService.html" >CollectionService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/DesignmodesService.html" >DesignmodesService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/ExampleserviceService.html" >ExampleserviceService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/FabricssimService.html" >FabricssimService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/FileService.html" >FileService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/FilesystemService.html" >FilesystemService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/ImageService.html" >ImageService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/InkService.html" >InkService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/LayersService.html" >LayersService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/MaterialsService.html" >MaterialsService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/MultiselectService.html" >MultiselectService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/NotesService.html" >NotesService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/OperationDescriptionsService.html" >OperationDescriptionsService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/OperationService.html" >OperationService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/PatternfinderService.html" >PatternfinderService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/RenderService.html" >RenderService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/SimulationService.html" >SimulationService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/StateService.html" >StateService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/SystemsService.html" >SystemsService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/TreeService.html" >TreeService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/UploadService.html" >UploadService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/VaeService.html" >VaeService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/VersionService.html" >VersionService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/ViewportService.html" >ViewportService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/WorkspaceService.html" >WorkspaceService</a>
                                </li>
                                <li class="link">
                                    <a href="../injectables/ZoomService.html" >ZoomService</a>
                                </li>
                        </ul>
                    </li>
            
                    <li class="chapter">
                        <div class="simple">
                            <span class="fa fa-info"></span>
                            <span>Interfaces</span>
                            <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                    data-target="#xs-interfaces-links"
                                ></span>
                        </div>
                        <ul class="links collapse in"
                                id="xs-interfaces-links"
                            >
                                <li class="link">
                                    <a href="../interfaces/AnalyzedImage.html" >AnalyzedImage</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/Bounds.html" >Bounds</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/Cell.html" >Cell</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/ComboNode.html" >ComboNode</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/ComboTree.html" >ComboTree</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/DensityUnits.html" >DensityUnits</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/DesignActions.html" >DesignActions</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/DesignMode.html" >DesignMode</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/Draft.html" >Draft</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/DraftMap.html" >DraftMap</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/DraftNodeProxy.html" >DraftNodeProxy</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/FileObj.html" >FileObj</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/FileSaver.html" >FileSaver</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/Fileloader.html" >Fileloader</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/HistoryState.html" >HistoryState</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/IOTuple.html" >IOTuple</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/Ink.html" >Ink</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/Interlacement.html" >Interlacement</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/InterlacementVal.html" >InterlacementVal</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/Item.html" >Item</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/LoadResponse.html" >LoadResponse</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/LoomTypes.html" >LoomTypes</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/Material.html" >Material</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/MaterialMap.html" >MaterialMap</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/MaterialTypes.html" >MaterialTypes</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/Model.html" >Model</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/NodeComponentProxy.html" >NodeComponentProxy</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/Note.html" >Note</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/OpComponentProxy.html" >OpComponentProxy</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/OpInput.html" >OpInput</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/OpParamVal.html" >OpParamVal</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/OperationClassification.html" >OperationClassification</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/Point.html" >Point</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/SaveObj.html" >SaveObj</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/StartOptions.html" >StartOptions</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/StatusMessage.html" >StatusMessage</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/System.html" >System</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/TreeNode.html" >TreeNode</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/TreeNodeProxy.html" >TreeNodeProxy</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/Upload.html" >Upload</a>
                                </li>
                                <li class="link">
                                    <a href="../interfaces/ViewModes.html" >ViewModes</a>
                                </li>
                        </ul>
                    </li>
            
            
                    <li class="chapter">
                        <a data-type="chapter-link" href="../miscellaneous.html" ><span class="fa fa-cubes"></span>Miscellaneous</a>
                    </li>
            
                    <li class="chapter">
                        <a data-type="chapter-link" href="../coverage.html" ><span class="fa fa-tasks"></span>Documentation coverage</a>
                    </li>
            
                    <li class="divider"></li>
                    <li class="copyright">
                            Documentation generated using <a href="https://compodoc.github.io/compodoc/" target="_blank">
                                        <img src="..//images/compodoc-vectorise.svg" class="img-responsive">
                            </a>
                    </li>
            
                </ul>
            
            </nav>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <nav>
                   
                       <ul class="list">
                   
                           <li class="title">
                               <a href="../">adacad documentation</a>
                           </li>
                   
                           <li class="divider"></li>
                   
                               <div id="book-search-input" role="search">
                                   <input type="text" placeholder="Type to search">
                               </div>
                   
                           <li class="chapter">
                               <a data-type="chapter-link" href="../"><span class="fa fa-home"></span>Getting started</a>
                               <ul class="links">
                                       <li class="link">
                                           <a href="../" ><span class="fa fa-file-text-o"></span>README</a>
                                       </li>
                                       <li class="link">
                                           <a 
                                               
                                                href="../overview.html" 
                                                href="../overview.html" 
                                               >
                                               <span class="fa fa-th"></span>Overview
                                           </a>
                                       </li>
                               </ul>
                           </li>
                   
                           <li class="chapter">
                               <a data-type="chapter-link" href="./modules.html" >
                                   <span class="fa fa-archive"></span>
                                   <span>Modules</span>
                                   <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                           data-target="#modules-links"
                                   ></span>
                               </a>
                               <ul class="links collapse in"
                                       id="modules-links"
                   >
                                       <li class="link">
                                           <a href="../modules/AppModule.html" >AppModule</a>
                                       </li>
                                       <li class="link">
                                           <a href="../modules/AppRoutingModule.html" >AppRoutingModule</a>
                                       </li>
                                       <li class="link">
                                           <a href="../modules/CoreModule.html" >CoreModule</a>
                                       </li>
                                       <li class="link">
                                           <a href="../modules/DraftDetailModule.html" >DraftDetailModule</a>
                                       </li>
                                       <li class="link">
                                           <a href="../modules/MixerModule.html" >MixerModule</a>
                                       </li>
                               </ul>
                           </li>
                   
                           <li class="chapter">
                               <div class="simple">
                                   <span class="fa fa-cogs"></span>
                                   <span>Components</span>
                                   <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                           data-target="#components-links"
                   ></span>
                               </div>
                               <ul class="links collapse in"
                                       id="components-links"
                   >
                                       <li class="link">
                                           <a href="../components/AboutModal.html" >AboutModal</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/ActionsComponent.html" >ActionsComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/AppComponent.html" >AppComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/BlankdraftModal.html" >BlankdraftModal</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/ConnectionComponent.html" >ConnectionComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/CrosssectionComponent.html" >CrosssectionComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/DesignComponent.html" >DesignComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/DraftDetailComponent.html" >DraftDetailComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/DraftviewerComponent.html" >DraftviewerComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/ExamplesComponent.html" >ExamplesComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/FilebrowserComponent.html" >FilebrowserComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/ImageComponent.html" >ImageComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/InitModal.html" >InitModal</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/InletComponent.html" >InletComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/LoadfileComponent.html" >LoadfileComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/LoginComponent.html" >LoginComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/LoomModal.html" >LoomModal</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/MaterialModal.html" >MaterialModal</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/MaterialsComponent.html" >MaterialsComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/MixerComponent.html" >MixerComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/MixerViewComponent.html" >MixerViewComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/NoteComponent.html" >NoteComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/OpHelpModal.html" >OpHelpModal</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/OperationComponent.html" >OperationComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/OpsComponent.html" >OpsComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/PaletteComponent.html"  class="active" >PaletteComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/ParameterComponent.html" >ParameterComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/ProfileComponent.html" >ProfileComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/QuickopComponent.html" >QuickopComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/SelectionComponent.html" >SelectionComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/SidebarComponent.html" >SidebarComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/SignupComponent.html" >SignupComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/SimulationComponent.html" >SimulationComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/SnackbarComponent.html" >SnackbarComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/SubdraftComponent.html" >SubdraftComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/SystemsComponent.html" >SystemsComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/TopbarComponent.html" >TopbarComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/UploadFormComponent.html" >UploadFormComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../components/WeaverViewComponent.html" >WeaverViewComponent</a>
                                       </li>
                               </ul>
                           </li>
                   
                           <li class="chapter">
                               <div class="simple">
                                   <span class="fa fa-code"></span>
                                   <span>Directives</span>
                                   <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                           data-target="#directives-links"
                   ></span>
                               </div>
                               <ul class="links collapse in"
                                       id="directives-links"
                   >
                                       <li class="link">
                                           <a href="../directives/KeycodesDirective.html" >KeycodesDirective</a>
                                       </li>
                                       <li class="link">
                                           <a href="../directives/MarqueeComponent.html" >MarqueeComponent</a>
                                       </li>
                                       <li class="link">
                                           <a href="../directives/SelectionComponent.html" >SelectionComponent</a>
                                       </li>
                               </ul>
                           </li>
                   
                           <li class="chapter">
                               <div class="simple">
                                   <span class="fa fa-file-code-o"></span>
                                   <span>Classes</span>
                                   <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                           data-target="#classes-links"
                   ></span>
                               </div>
                               <ul class="links collapse in"
                                       id="classes-links"
                   >
                                       <li class="link">
                                           <a href="../classes/AdaCADWeaverPage.html" >AdaCADWeaverPage</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/MyErrorStateMatcher.html" >MyErrorStateMatcher</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/Selection.html" >Selection</a>
                                       </li>
                                       <li class="link">
                                           <a href="../classes/Util.html" >Util</a>
                                       </li>
                               </ul>
                           </li>
                   
                           <li class="chapter">
                               <a data-type="chapter-link" href="../routes.html" ><span class="fa fa-code-fork"></span>Routes</a>
                           </li>
                   
                           <li class="chapter">
                               <div class="simple">
                                   <span class="fa fa-long-arrow-down"></span>
                                   <span>Injectables</span>
                                   <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                           data-target="#injectables-links"
                   ></span>
                               </div>
                               <ul class="links collapse in"
                                       id="injectables-links"
                   >
                                       <li class="link">
                                           <a href="../injectables/AuthService.html" >AuthService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/CollectionService.html" >CollectionService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/DesignmodesService.html" >DesignmodesService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/ExampleserviceService.html" >ExampleserviceService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/FabricssimService.html" >FabricssimService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/FileService.html" >FileService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/FilesystemService.html" >FilesystemService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/ImageService.html" >ImageService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/InkService.html" >InkService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/LayersService.html" >LayersService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/MaterialsService.html" >MaterialsService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/MultiselectService.html" >MultiselectService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/NotesService.html" >NotesService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/OperationDescriptionsService.html" >OperationDescriptionsService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/OperationService.html" >OperationService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/PatternfinderService.html" >PatternfinderService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/RenderService.html" >RenderService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/SimulationService.html" >SimulationService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/StateService.html" >StateService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/SystemsService.html" >SystemsService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/TreeService.html" >TreeService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/UploadService.html" >UploadService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/VaeService.html" >VaeService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/VersionService.html" >VersionService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/ViewportService.html" >ViewportService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/WorkspaceService.html" >WorkspaceService</a>
                                       </li>
                                       <li class="link">
                                           <a href="../injectables/ZoomService.html" >ZoomService</a>
                                       </li>
                               </ul>
                           </li>
                   
                           <li class="chapter">
                               <div class="simple">
                                   <span class="fa fa-info"></span>
                                   <span>Interfaces</span>
                                   <span class="menu-toggler fa fa-angle-up" data-toggle="collapse"
                                           data-target="#interfaces-links"
                   ></span>
                               </div>
                               <ul class="links collapse in"
                                       id="interfaces-links"
                   >
                                       <li class="link">
                                           <a href="../interfaces/AnalyzedImage.html" >AnalyzedImage</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/Bounds.html" >Bounds</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/Cell.html" >Cell</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/ComboNode.html" >ComboNode</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/ComboTree.html" >ComboTree</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/DensityUnits.html" >DensityUnits</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/DesignActions.html" >DesignActions</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/DesignMode.html" >DesignMode</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/Draft.html" >Draft</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/DraftMap.html" >DraftMap</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/DraftNodeProxy.html" >DraftNodeProxy</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/FileObj.html" >FileObj</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/FileSaver.html" >FileSaver</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/Fileloader.html" >Fileloader</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/HistoryState.html" >HistoryState</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/IOTuple.html" >IOTuple</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/Ink.html" >Ink</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/Interlacement.html" >Interlacement</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/InterlacementVal.html" >InterlacementVal</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/Item.html" >Item</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/LoadResponse.html" >LoadResponse</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/LoomTypes.html" >LoomTypes</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/Material.html" >Material</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/MaterialMap.html" >MaterialMap</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/MaterialTypes.html" >MaterialTypes</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/Model.html" >Model</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/NodeComponentProxy.html" >NodeComponentProxy</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/Note.html" >Note</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/OpComponentProxy.html" >OpComponentProxy</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/OpInput.html" >OpInput</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/OpParamVal.html" >OpParamVal</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/OperationClassification.html" >OperationClassification</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/Point.html" >Point</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/SaveObj.html" >SaveObj</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/StartOptions.html" >StartOptions</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/StatusMessage.html" >StatusMessage</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/System.html" >System</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/TreeNode.html" >TreeNode</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/TreeNodeProxy.html" >TreeNodeProxy</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/Upload.html" >Upload</a>
                                       </li>
                                       <li class="link">
                                           <a href="../interfaces/ViewModes.html" >ViewModes</a>
                                       </li>
                               </ul>
                           </li>
                   
                   
                           <li class="chapter">
                               <a data-type="chapter-link" href="../miscellaneous.html" ><span class="fa fa-cubes"></span>Miscellaneous</a>
                           </li>
                   
                           <li class="chapter">
                               <a data-type="chapter-link" href="../coverage.html" ><span class="fa fa-tasks"></span>Documentation coverage</a>
                           </li>
                   
                           <li class="divider"></li>
                           <li class="copyright">
                                   Documentation generated using <a href="https://compodoc.github.io/compodoc/" target="_blank">
                                               <img src="..//images/compodoc-vectorise.svg" class="img-responsive">
                                   </a>
                           </li>
                   
                       </ul>
                   
                   </nav>
               </div>
               <div class="content component">
                   <div class="content-data">


<ol class="breadcrumb">
  <li>Components</li>
  <li>PaletteComponent</li>
</ol>


    <ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#infos" id="infos-tab" role="tab" data-toggle="tab">Infos</a>
        </li>
        <li>
            <a href="#source" role="tab" id="source-tab" data-toggle="tab">Source</a>
        </li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane fade active in" id="infos"><p class="comment">
    <h3>File</h3>
</p>
<p class="comment">
    <code>src/app/mixer/palette/palette.component.ts</code>
</p>



<section>
    <h3>Metadata</h3>
    <table class="table table-sm table-hover">
        <tbody>












            <tr>
                <td class="col-md-3">selector</td>
                <td class="col-md-9"><code>app-palette</code></td>
            </tr>

            <tr>
                <td class="col-md-3">styleUrls</td>
                <td class="col-md-9"><code>palette.component.scss</code></td>
            </tr>



            <tr>
                <td class="col-md-3">templateUrl</td>
                <td class="col-md-9"><code>palette.component.html</code></td>
            </tr>


        </tbody>
    </table>
</section>


    <section>
        <h3 id="outputs">Outputs</h3>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-2">
                            <code>onDesignModeChange</code>
                        </td>
                        <td class="col-md-10">
                            <em><code>$event</code> type:</em>    <code>any</code>

                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-2">
                            <code>onRevealDraftDetails</code>
                        </td>
                        <td class="col-md-10">
                            <em><code>$event</code> type:</em>    <code>any</code>

                        </td>
                    </tr>
                </tbody>
            </table>
    </section>

    <section>
        <h3 id="constructor">Constructor</h3>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <code>constructor(dm: <a href="../injectables/DesignmodesService.html" >DesignmodesService</a>, tree: <a href="../injectables/TreeService.html" >TreeService</a>, inks: <a href="../injectables/InkService.html" >InkService</a>, layers: <a href="../injectables/LayersService.html" >LayersService</a>, resolver: any, fs: <a href="../injectables/FileService.html" >FileService</a>, _snackBar: any, viewport: <a href="../injectables/ViewportService.html" >ViewportService</a>, notes: <a href="../injectables/NotesService.html" >NotesService</a>, ss: <a href="../injectables/StateService.html" >StateService</a>, zs: <a href="../injectables/ZoomService.html" >ZoomService</a>, multiselect: <a href="../injectables/MultiselectService.html" >MultiselectService</a>)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Constructs a palette object. The palette supports drawing without components and dynamically<br>creates components from shapes and scribbles on the canvas. </p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>dm</b>
                                                    </div>
                                                    <div>
                                                        <p>a reference to the service containing the current design modes and selections</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>tree</b>
                                                    </div>
                                                    <div>
                                                        <p>reference to the objects and relationships within this palette</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>inks</b>
                                                    </div>
                                                    <div>
                                                        <p>a reference to the service manaing the available inks</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>layers</b>
                                                    </div>
                                                    <div>
                                                        <p>a reference to the sercie managing the view layers (z-indexes) of components</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>resolver</b>
                                                    </div>
                                                    <div>
                                                        <p>a reference to the factory component for dynamically generating components</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>fs</b>
                                                    </div>
                                                    <div>
                                                        <p>file service for saving and loading files</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>_snackBar</b>
                                                    </div>
                                                    <div>
                                                        <p>_snackBar a reference to the snackbar component that shows data on move and select</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>viewport</b>
                                                    </div>
                                                    <div>
                                                        <p>reference to the window and palette variables and where the viewer is currently lookin</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>notes</b>
                                                    </div>
                                                    <div>
                                                        <p>reference the service that stores all the tagged comments</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
    </section>

    <section>
        <h3 id="methods">Methods</h3>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> unsubscribeFromAll</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>unsubscribeFromAll()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>the only way to prevent memory leaks is to unsubscribe.<br>since we lose access to tree when a new file is uploaded we must unsubscribe<br>when any upload action is taking place. If no action takes place, then resubscribe</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> resubscribe</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>resubscribe()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>resubscribes to each subscription</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> clearComponents</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>clearComponents()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called when a new file is loaded</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> handleScroll</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>handleScroll(position: Point)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called when user moves position within viewer</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>data</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> handlePan</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>handlePan(diff: Point)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called when user moves position within viewer</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>data</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> handleScrollFromZoom</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>handleScrollFromZoom(old_zoom: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>when someone zooms in or out, we&#39;d like to keep the center point the same. We do this by scaling the entire palette and<br>elements and then manually scrolling to the new center point. </p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>data</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> handleWindowScroll</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>handleWindowScroll(data: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called when user scrolls the winidow</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>data</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> removeFromViewContainer</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>removeFromViewContainer(ref: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>removes the view associate with this view ref</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>ref</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> addTimelineState</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>addTimelineState()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>adds a state to the timeline. This should be called<br>each time a user performs an action that they should be able to undo/redo</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier"></span> downloadVisibleDraftsAsBmp</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play ">
                                    <span class="fa fa-"></span>
                                </span>
                            <code>downloadVisibleDraftsAsBmp()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>this cycles through all subdrafts and calls the download call on any subdrafts<br>who are currently visible. </p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>any</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier"></span> downloadVisibleDraftsAsWif</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play ">
                                    <span class="fa fa-"></span>
                                </span>
                            <code>downloadVisibleDraftsAsWif()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>this cycles through all subdrafts and calls the download call on any subdrafts<br>who are currently visible. </p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>any</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> addOperation</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>addOperation(name: string)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>//  <em> called anytime an operation is added. Adds the operation to the tree.<br>//  </em> @param name the name of the operation to add<br>//  </p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>number</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> pasteOperation</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>pasteOperation(opnode: OpNode)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>//  <em> called anytime an operation is added. Adds the operation to the tree.<br>//  </em> @param name the name of the operation to add<br>//  </p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>any</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> rescale</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>rescale(prev_zoom: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>redraws each operation and subdraft at the new scale, then redraws each of their connections</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>scale</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> startSnackBar</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>startSnackBar(message: string, bounds: Bounds)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>loads the snackbar at the bottom of the screen</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>message</b>
                                                    </div>
                                                    <div>
                                                        <p>the message to show on the snack bar</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>bounds</b>
                                                    </div>
                                                    <div>
                                                        <p>the bounds of the element that we are showing info aboout</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> snackBarAlert</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>snackBarAlert(message: string)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> updateSnackBar</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>updateSnackBar(message: string, bounds: Bounds)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>updates data shown on the snackbar</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>message</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>bounds</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> closeSnackBar</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>closeSnackBar()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called to close the snackbar</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> changeDesignmode</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>changeDesignmode(name: string)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called when the palette needs to change the design mode, emits output to parent</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>name</b>
                                                    </div>
                                                    <div>
                                                        <ul>
    <li>the mode to switchh to</li>
    </ul>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> setSubdraftSubscriptions</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>setSubdraftSubscriptions(sd: SubdraftComponent)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called when a new subdraft is created</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>sd</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> revealDraftDetails</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>revealDraftDetails(id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> createNote</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>createNote(note: Note)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>dynamically creates a a note component</p>
    </div>
                                <div class="io-description">
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>NoteComponent</code>
    
                                </div>
                                    <div class="io-description">
                                        <p>the created note instance</p>
    
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> setNoteSubscriptions</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>setNoteSubscriptions(note: NoteComponent)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called when a new operation is added</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>op</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> deleteNote</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>deleteNote(id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> saveNote</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>saveNote()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> createSubDraft</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>createSubDraft(d: Draft, parent: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>dynamically creates a subdraft component, adds its inputs and event listeners, pushes the subdraft to the list of references</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>d</b>
                                                    </div>
                                                    <div>
                                                        <p>a Draft object for this component to contain</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>any</code>
    
                                </div>
                                    <div class="io-description">
                                        <p>the created subdraft instance</p>
    
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> createSubDraftFromEditedDetail</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>createSubDraftFromEditedDetail(id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>any</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> loadSubDraft</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>loadSubDraft(id: number, d: Draft, nodep: NodeComponentProxy, draftp: DraftNodeProxy, saved_scale: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>loads a subdraft component from data</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>id</b>
                                                    </div>
                                                    <div>
                                                        <p>the node id assigned to this element on load</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>d</b>
                                                    </div>
                                                    <div>
                                                        <p>the draft object to load into this subdraft</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>nodep</b>
                                                    </div>
                                                    <div>
                                                        <p>the component proxy used to define</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> setConnectionSubscriptions</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>setConnectionSubscriptions(cxn: ConnectionComponent)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> setOperationSubscriptions</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>setOperationSubscriptions(op: OperationComponent)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called when a new operation is added</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>op</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> createOperation</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>createOperation(name: string)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>creates an operation component</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>name</b>
                                                    </div>
                                                    <div>
                                                        <p>the name of the operation this component will perform</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>OperationComponent</code>
    
                                </div>
                                    <div class="io-description">
                                        <p>the OperationComponent created</p>
    
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> loadOperation</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>loadOperation(id: number, name: string, params: any[], inlets: any[], topleft: Point, saved_scale: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>loads an operation with the information supplied. </p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>name</b>
                                                    </div>
                                                    <div>
                                                        <p>the name of the operation this component will perform</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        <p>the id of the node this has been assigned to</p>
    
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> duplicateOperation</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>duplicateOperation(name: string, params: number[], topleft: Point, inlets: any[])</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>duplicates an operation with the information supplied. </p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>name</b>
                                                    </div>
                                                    <div>
                                                        <p>the name of the operation this component will perform</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>number</code>
    
                                </div>
                                    <div class="io-description">
                                        <p>the id of the node this has been assigned to</p>
    
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> loadConnection</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>loadConnection(id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>creates a connection and draws it to screen</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>id</b>
                                                    </div>
                                                    <div>
                                                        <ul>
    <li>the id of this node</li>
    </ul>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> createConnection</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>createConnection(id_from: number, id_to: number, to_ndx: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>creates a connection component and registers it with the tree</p>
    </div>
                                <div class="io-description">
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>{ input_ids: number[]; id: number; }</code>
    
                                </div>
                                    <div class="io-description">
                                        <p>the list of all id&#39;s connected to the &quot;to&quot; node </p>
    
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> addSubdraftFromDraft</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>addSubdraftFromDraft(d: Draft)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called from upload or import events</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>d</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> pasteSubdraft</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>pasteSubdraft(draftnode: DraftNode)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>//  <em> called anytime an operation is added. Adds the operation to the tree.<br>//  </em> @param name the name of the operation to add<br>//  </p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>any</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> removeSubdraft</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>removeSubdraft(id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>a subdraft can only have an operation for a parent<br>removes the subdraft sent to the function<br>updates the tree view_id&#39;s in response</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>id</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> removeOperation</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>removeOperation(id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>this calls the tree to delete the operation.<br>the tree returns a list of all nodes deleted and this function updates the view to remove those elements</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>id</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> createAndSetPreview</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>createAndSetPreview(d: Draft)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>dynamically creates a subdraft component with specific requirements of the intersection, adds its inputs and event listeners, pushes the subdraft to the list of references</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>d</b>
                                                    </div>
                                                    <div>
                                                        <p>a Draft object for this component to contain</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>any</code>
    
                                </div>
                                    <div class="io-description">
                                        <p>the created subdraft instance</p>
    
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> removePreview</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>removePreview()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>destorys the preview component</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier">Public</span> designModeChanged</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play circle">
                                    <span class="fa fa-circle"></span>
                                </span>
                            <code>designModeChanged()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Called from mixer when it receives a change from the design mode tool or keyboard press<br>triggers view mode changes required for this mode</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier">Private</span> removeSubscription</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play lock">
                                    <span class="fa fa-lock"></span>
                                </span>
                            <code>removeSubscription()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>specifically removes the subscription from the move event</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier">Private</span> drawSelection</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play lock">
                                    <span class="fa fa-lock"></span>
                                </span>
                            <code>drawSelection(ndx: Interlacement)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>draws the selection atop the view<br>todo: update this to account for scroll</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>ndx</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier">Private</span> getRelativeInterlacement</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play lock">
                                    <span class="fa fa-lock"></span>
                                </span>
                            <code>getRelativeInterlacement(abs: Interlacement)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Takes an absolute index and returns it to an index relative to the viewport. </p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>abs</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>Interlacement</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier">Private</span> setCell</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play lock">
                                    <span class="fa fa-lock"></span>
                                </span>
                            <code>setCell(ndx: Interlacement)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>sets the value of the scratchpad cell at ndx<br>checks for self interselcting </p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>ndx</b>
                                                    </div>
                                                    <div>
                                                        <p>(i,j)</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier">Private</span> computeCellColor</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play lock">
                                    <span class="fa fa-lock"></span>
                                </span>
                            <code>computeCellColor(ink: string, over: Cell, under: boolean)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called by drawcell. Draws on screen based on the current ink</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>ink</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>over</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>under</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>string</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier">Private</span> computeCellValue</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play lock">
                                    <span class="fa fa-lock"></span>
                                </span>
                            <code>computeCellValue(ink: string, over: Cell, under: boolean)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>applies the filter betetween over and under and returns the result</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>ink</b>
                                                    </div>
                                                    <div>
                                                        <p>the ink with which to compute the transition</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>over</b>
                                                    </div>
                                                    <div>
                                                        <p>the value of the primary (top) cell</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>under</b>
                                                    </div>
                                                    <div>
                                                        <p>the value of the intersecting (bottom) cell </p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>boolean</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier">Private</span> getScratchpadProduct</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play lock">
                                    <span class="fa fa-lock"></span>
                                </span>
                            <code>getScratchpadProduct(ndx: Interlacement, ink: string, over: Cell)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called when creating a subdraft from the drawing on the screen. Computes the resulting value based on<br>all intersections with the drawing</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>ndx</b>
                                                    </div>
                                                    <div>
                                                        <p>the i,j location of the cell we are checking</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>ink</b>
                                                    </div>
                                                    <div>
                                                        <p>the currently selected ink</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>over</b>
                                                    </div>
                                                    <div>
                                                        <p>the Cell we are checking against</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>boolean</code>
    
                                </div>
                                    <div class="io-description">
                                        <p>true/false or null</p>
    
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier">Private</span> drawCell</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play lock">
                                    <span class="fa fa-lock"></span>
                                </span>
                            <code>drawCell(ndx: Interlacement)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>draw the cell at position ndx</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>ndx</b>
                                                    </div>
                                                    <div>
                                                        <p>(i,j)</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> onDeleteSubdraftCalled</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>onDeleteSubdraftCalled(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Deletes the subdraft that called this function.</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> onDeleteOperationCalled</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>onDeleteOperationCalled(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Deletes the subdraft that called this function.</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> onDuplicateOpCalled</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>onDuplicateOpCalled(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Duplicates the operation that called this function.</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> onDuplicateSubdraftCalled</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>onDuplicateSubdraftCalled(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>This is called when the finetune mode is closed and we need to create a new subdraft to hold the changes. </p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                            :     <code>parent_id</code>
    
                                                    </div>
                                                    <div>
                                                        <p>, new_id}</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> subdraftStarted</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>subdraftStarted(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>A mouse event, originated in a subdraft, has been started<br>checkes the design mode and handles the event as required</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                    </div>
                                                    <div>
                                                        <p>contains the id of the moving subdraft</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> onConnectionStarted</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>onConnectionStarted(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>triggers a mode that allows mouse-mouse to be followed by a line.<br>todo; add code that holds the point on scroll</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                    </div>
                                                    <div>
                                                        <ul>
    <li>contains event, id of component who called</li>
    </ul>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> freezePaletteObjects</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>freezePaletteObjects()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>adds a connector flag to any subdrafts that we are allowed to connect to from this operation<br>disables selection and pointer events on all<br>disables selection and pointer events on all</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> unfreezePaletteObjects</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>unfreezePaletteObjects()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>unfreezes all palette objects (except connections)</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> onSubdraftViewChange</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>onSubdraftViewChange(id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>this is called when an subdraft updates its show/hide value</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> onSubdraftNameChange</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>onSubdraftNameChange(id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>this is called when an subdraft updates its show/hide value</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> connectionDragged</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>connectionDragged(mouse: Point, shift: boolean)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>draws when a user is using the mouse to identify an input to a component</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>mouse</b>
                                                    </div>
                                                    <div>
                                                        <p>the absolute position of the mouse on screen</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>shift</b>
                                                    </div>
                                                    <div>
                                                        <p>boolean representing if shift is pressed as well </p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> processConnectionEnd</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>processConnectionEnd()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>resets the view when a connection event ends</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> calculateInitialLocaiton</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>calculateInitialLocaiton(id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>calculates the default topleft position for this node based on the width and size of its parent and/or neighbors</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>id</b>
                                                    </div>
                                                    <div>
                                                        <p>the id of the component to position</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>Point</code>
    
                                </div>
                                    <div class="io-description">
                                        <p>a promise for the updated point</p>
    
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> performAndUpdateDownstream</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>performAndUpdateDownstream(op_id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>this calls a function for an operation to perform and then subsequently calls all children<br>to recalculate. After each calculation, it redraws and or creates any new subdrafts</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>op_id</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>any</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> updateDownstream</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>updateDownstream(subdraft_id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>when a subdraft is closed, it has no operation to run before updaing downstream, instead it ONLY needs to update the downstream values</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>subdraft_id</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> highlightPathToInlet</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>highlightPathToInlet(op_id: number, inlet_id: number, ndx_in_inlets: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>when an inlet is pressed on an operation, highlight all things contributed to this inlet</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>op_id</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>inlet_id</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>ndx_in_inlets</b>
                                                    </div>
                                                    <div>
                                                        <ul>
    <li>if there aremultiple inputs at a single inlet, give the number in that list</li>
    </ul>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> resetOpacity</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>resetOpacity()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> updateVisibility</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>updateVisibility(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called from an operation or inlet to allow for the inlighting of all upstream operations and drafts</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> inletLoaded</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>inletLoaded(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called from an operation or inlet to allow for the inlighting of all upstream operations and drafts</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> opCompLoaded</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>opCompLoaded(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called from an operation or inlet to allow for the inlighting of all upstream operations and drafts</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> connectionMade</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>connectionMade(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>emitted from operation when it receives a hit on its connection button, the id refers to the operation id</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> pasteConnection</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>pasteConnection(from: number, to: number, inlet: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> removeConnection</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>removeConnection(obj: { id: number; })</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Called when a connection is explicitly deleted</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> selectionStarted</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>selectionStarted()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> panStarted</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>panStarted(mouse_pos: Point)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> shapeStarted</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>shapeStarted(mouse: Point)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>brings the base canvas to view and begins to render the</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>mouse</b>
                                                    </div>
                                                    <div>
                                                        <p>the absolute position of the mouse on screen</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> shapeDragged</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>shapeDragged(mouse: Point, shift: boolean)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>resizes and redraws the shape between the the current mouse and where the shape started</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>mouse</b>
                                                    </div>
                                                    <div>
                                                        <p>the absolute position of the mouse on screen</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> drawStarted</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>drawStarted()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>clears the scratchpad for the new drawing event</p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> getScratchPadBounds</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>getScratchPadBounds()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>gets the bounds of a drawing on the scratchpad, a drawing is represented by set cells</p>
    </div>
                                <div class="io-description">
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>Interlacement[]</code>
    
                                </div>
                                    <div class="io-description">
                                        <p>an object representing the bounds in the format of i, j (the row, column index of the pad)</p>
    
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> processDrawingEnd</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>processDrawingEnd()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>handles checks and actions to take when drawing event ends<br>gets the boudary of drawn segment and creates a subdraft containing that drawing<br>if the drawing sits on top of an existing subdraft, merge the drawing into that subdraft (extending the original if neccessary)</p>
    </div>
                                <div class="io-description">
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>any</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> onResize</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>onResize(event: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>update the viewport when the window is resized</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>event</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier">Private</span> onStart</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play lock">
                                    <span class="fa fa-lock"></span>
                                </span>
                            <code>onStart(event: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>handles actions to take when the mouse is down inside of the palette</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>event</b>
                                                    </div>
                                                    <div>
                                                        <p>the mousedown event</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier">Private</span> onMove</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play lock">
                                    <span class="fa fa-lock"></span>
                                </span>
                            <code>onMove(event: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> mouseSelectingDraft</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>mouseSelectingDraft(event: any, id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called when the operation input is selected and used to draw</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>event</b>
                                                    </div>
                                                    <div>
                                                        <p>the event object</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> onDrag</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>onDrag(event: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called form the subscription created on start, checks the index of the location and returns null if its the same</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>event</b>
                                                    </div>
                                                    <div>
                                                        <p>the event object</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier">Private</span> onEnd</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play lock">
                                    <span class="fa fa-lock"></span>
                                </span>
                            <code>onEnd(event: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Called when the mouse is up or leaves the boundary of the view</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>event</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> processSelection</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>processSelection()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Called when a selection operation ends. Checks to see if this selection intersects with any subdrafts and<br>merges and or splits as required. </p>
    </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> updateAttachedComponents</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>updateAttachedComponents(id: number, follow: boolean)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>this function will update any components that should move when the compoment passed by obj moves<br>moves all compoments returned from tree.getNodesToUpdate(). All changes to what updates should be<br>handled by getNodesToUpdateOnMove</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> onSubdraftAction</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>onSubdraftAction(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>emitted from a subdraft when an internal action has changeded its value<br>checks for a child subdraft, recomputes, redraws. </p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                    </div>
                                                    <div>
                                                        <p>with attribute id describing the subdraft that called this</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b><span class="modifier"></span> operationParamChanged</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <span class="modifier-icon method fa fa-play ">
                                    <span class="fa fa-"></span>
                                </span>
                            <code>operationParamChanged(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>emitted from an operatioin when its param has changed. This is automatically called on load<br>which is annoying because it recomputes everything!<br>checks for a child subdraft, recomputes, redraws. </p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                    </div>
                                                    <div>
                                                        <p>with attribute id describing the operation that called this</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> paletteClicked</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>paletteClicked()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> operationMoved</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>operationMoved(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called from an operation component when it is dragged</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                    </div>
                                                    <div>
                                                        <p>(id, point of toplleft)</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> operationMoveEnded</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>operationMoveEnded(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called from an operation component when it is done moving<br>this allows us to not write postioin continuously, but just once on end</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                    </div>
                                                    <div>
                                                        <p>(id, point of toplleft)</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> updateSelectionPositions</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>updateSelectionPositions(moving_id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> moveAllSelections</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>moveAllSelections(moving_id: number)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>this is called when a multi-selected block of items is moved.<br>Sometimes its called if you paste one set of items to a new space, in which case the nodes do<br>not yet exist. </p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>moving_id</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> subdraftMoved</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>subdraftMoved(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>called when subdraft component says its moving</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                    </div>
                                                    <div>
                                                        <p>the subdraft that called this</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> subdraftDropped</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>subdraftDropped(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>checks if this subdraft has been dropped onto of another and merges them accordingly </p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> computeHeddleValue</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>computeHeddleValue(p: Point, main: SubdraftComponent, isect: SubdraftComponent[])</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>merges a collection of subdraft components into the primary component, deletes the merged components</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>primary</b>
                                                    </div>
                                                    <div>
                                                        <p>the draft to merge into</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>boolean</code>
    
                                </div>
                                    <div class="io-description">
                                        <p>true or false to describe if a merge took place. </p>
    
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> getSelectionBounds</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>getSelectionBounds(c1: any, c2: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>get any subdrafts that intersect a given screen position<br>get any subdrafts that intersect primary based on checks on their boundaries</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>p</b>
                                                    </div>
                                                    <div>
                                                        <p>the x, y position of this cell </p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>Bounds</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> getCombinedDraft</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>getCombinedDraft(bounds: Bounds, primary: SubdraftComponent, isect: SubdraftComponent[])</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>creates a draft in size bounds that contains all of the computed points of its intersections</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>bounds</b>
                                                    </div>
                                                    <div>
                                                        <p>the boundary of all the intersections</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>primary</b>
                                                    </div>
                                                    <div>
                                                        <p>the primary draft that we are checking for intersections</p>
    
                                                    </div>
                                                </li>
                                                <li>
                                                    <div>
                                                        <b>isect</b>
                                                    </div>
                                                    <div>
                                                        <p>an Array of the intersecting components</p>
    
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>Draft</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> getPrintableCanvas</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>getPrintableCanvas(obj: any)</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>TODO: Update this to get bounds and print all items, not just what&#39;s visible</p>
    </div>
                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <ul class="jsdoc-params">
                                                <li>
                                                    <div>
                                                        <b>obj</b>
                                                    </div>
                                                    <div>
                                                        
                                                    </div>
                                                </li>
                                        </ul>
                                </div>
                                <div class="io-description">
                                    <b>Returns: </b>    <code>HTMLCanvasElement</code>
    
                                </div>
                                    <div class="io-description">
                                        
                                    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> clearCanvas</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>clearCanvas()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> redrawAllSubdrafts</b>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
    <code>redrawAllSubdrafts()</code>
                        </td>
                    </tr>
    
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description">
                                    <b>Returns: </b>    <code>void</code>
    
                                </div>
                        </td>
                    </tr>
                </tbody>
            </table>
    </section>

    <section>
        <h3 id="inputs">Properties</h3>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> canvas</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>canvas:     <code>HTMLCanvasElement</code>
    </bcode>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>HTML Canvas element that draws the selection and currently cells drawn on this component</p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> canvas_zndx</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>canvas_zndx:     <code>number</code>
    </bcode>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>links to the z-index to push the canvas to the front or back of view when freehand drawing. </p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> connectionSubscriptions</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>connectionSubscriptions:     <code>any[]</code>
    </bcode>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> cx</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>cx:     <code>any</code>
    </bcode>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> default_cell_size</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>default_cell_size:     <code>number</code>
    </bcode>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                <i>Default value: </i><code>5</code>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>a reference to the base size of each cell. Zoom in and out only modifies the view, not this base size.</p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> dm</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>dm:     <code><a href="../injectables/DesignmodesService.html" target="_self" >DesignmodesService</a></code>
    </bcode>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> last</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>last:     <code>Interlacement</code>
    </bcode>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>stores an i and j of the last user selected location within the component</p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> last_point</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>last_point:     <code>Point</code>
    </bcode>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>stores an i and j of the last user selected location within the component</p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> moveSubscription</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>moveSubscription:     <code>any</code>
    </bcode>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>Subscribes to move event after a touch event is started.</p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> needs_init</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>needs_init:     <code>boolean</code>
    </bcode>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                <i>Default value: </i><code>true</code>
                            </td>
                        </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> noteSubscriptions</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>noteSubscriptions:     <code>any[]</code>
    </bcode>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> operationSubscriptions</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>operationSubscriptions:     <code>any[]</code>
    </bcode>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> pointer_events</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>pointer_events:     <code>boolean</code>
    </bcode>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>triggers a class to handle disabling pointerevents when switching modes</p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> scale_string</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>scale_string:     <code>string</code>
    </bcode>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>a string to represent the current user defined scale for this component to be used in background grid css. </p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> scratch_pad</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>scratch_pad:     <code>Cell[][]</code>
    </bcode>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>holds the data of events drawn on this component (that are not associated with a subdraft)</p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> selecting_connection</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>selecting_connection:     <code>boolean</code>
    </bcode>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                <i>Default value: </i><code>false</code>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>flag to determine how conneection should be drawn</p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> selection</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>selection:     <code>MarqueeComponent</code>
    </bcode>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>holds a reference to the selection component</p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> shape_bounds</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>shape_bounds:     <code>Bounds</code>
    </bcode>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>stores the bounds of the shape being drawn</p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> shape_vtxs</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>shape_vtxs:     <code>Point[]</code>
    </bcode>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>stores the vtx for freehand shapes</p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> snack_bounds</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>snack_bounds:     <code>Bounds</code>
    </bcode>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> snack_message</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>snack_message:     <code>string</code>
    </bcode>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>trackable inputs to snackbar</p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> subdraftSubscriptions</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>subdraftSubscriptions:     <code>any[]</code>
    </bcode>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> vc</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>vc:     <code>any</code>
    </bcode>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <div class="io-description"><p>A container that supports the automatic generation and removal of the components inside of it</p>
    </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> viewport</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>viewport:     <code><a href="../injectables/ViewportService.html" target="_self" >ViewportService</a></code>
    </bcode>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> visible_op</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>visible_op:     <code>number</code>
    </bcode>
                        </td>
                    </tr>
                </tbody>
            </table>
            <table class="table table-sm table-bordered">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <b> visible_op_inlet</b>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <code>visible_op_inlet:     <code>number</code>
    </bcode>
                        </td>
                    </tr>
                </tbody>
            </table>
    </section>
</div>
        <div class="tab-pane fade tab-source-code" id="source">
            <pre><code class="hljs javascript">import { Component, ComponentFactoryResolver, EventEmitter, HostListener, OnInit, Output, ViewChild, ViewContainerRef, ViewRef } from &#x27;@angular/core&#x27;;
import { MatSnackBar } from &#x27;@angular/material/snack-bar&#x27;;
import { fromEvent, Subscription } from &#x27;rxjs&#x27;;
import { defaults } from &#x27;../../core/model/defaults&#x27;;
import { createCell, getCellValue, setCellValue } from &#x27;../../core/model/cell&#x27;;
import { Bounds, Draft, DraftNode, DraftNodeProxy, Interlacement, NodeComponentProxy, Note, Node, Point, Cell, OpNode, Operation} from &#x27;../../core/model/datatypes&#x27;;
import { copyDraft, getDraftName, initDraftWithParams, warps, wefts } from &#x27;../../core/model/drafts&#x27;;
import utilInstance from &#x27;../../core/model/util&#x27;;
import { DesignmodesService } from &#x27;../../core/provider/designmodes.service&#x27;;
import { NotesService } from &#x27;../../core/provider/notes.service&#x27;;
import { StateService } from &#x27;../../core/provider/state.service&#x27;;
import { TreeService } from &#x27;../../core/provider/tree.service&#x27;;
import { InkService } from &#x27;../../mixer/provider/ink.service&#x27;;
import { LayersService } from &#x27;../../mixer/provider/layers.service&#x27;;
import { MultiselectService } from &#x27;../provider/multiselect.service&#x27;;
import { ViewportService } from &#x27;../provider/viewport.service&#x27;;
import { ZoomService } from &#x27;../provider/zoom.service&#x27;;
import { FileService } from &#x27;./../../core/provider/file.service&#x27;;
import { ConnectionComponent } from &#x27;./connection/connection.component&#x27;;
import { MarqueeComponent } from &#x27;./marquee/marquee.component&#x27;;
import { NoteComponent } from &#x27;./note/note.component&#x27;;
import { OperationComponent } from &#x27;./operation/operation.component&#x27;;
import { SnackbarComponent } from &#x27;./snackbar/snackbar.component&#x27;;
import { SubdraftComponent } from &#x27;./subdraft/subdraft.component&#x27;;
import { child } from &#x27;firebase/database&#x27;;

@Component({
  selector: &#x27;app-palette&#x27;,
  templateUrl: &#x27;./palette.component.html&#x27;,
  styleUrls: [&#x27;./palette.component.scss&#x27;]
})


export class PaletteComponent implements OnInit{


  @Output() onDesignModeChange: any &#x3D; new EventEmitter();  
  @Output() onRevealDraftDetails: any &#x3D; new EventEmitter();  

  /**
   * A container that supports the automatic generation and removal of the components inside of it
   */
  @ViewChild(&#x27;vc&#x27;, {read: ViewContainerRef, static: true}) vc: ViewContainerRef;

  subdraftSubscriptions: Array&lt;Subscription&gt; &#x3D; [];
  operationSubscriptions: Array&lt;Subscription&gt; &#x3D; [];
  connectionSubscriptions: Array&lt;Subscription&gt; &#x3D; [];
  noteSubscriptions: Array&lt;Subscription&gt; &#x3D; [];


/**
 * Subscribes to move event after a touch event is started.
 * @property {Subscription}
 */
  moveSubscription: Subscription;

  /**
   * flag to determine how conneection should be drawn
   */
  selecting_connection: boolean &#x3D; false;

  /**
   * holds a reference to the selection component
   * @property {Selection}
   */
  selection &#x3D; new MarqueeComponent();

  /**
   * holds the data of events drawn on this component (that are not associated with a subdraft)
   * @property {Array&lt;Array&lt;Cell&gt;&gt;}
   */
  scratch_pad: Array&lt;Array&lt;Cell&gt;&gt; &#x3D; [];

  /**
   * HTML Canvas element that draws the selection and currently cells drawn on this component
   * @property {Canvas}
   */
  canvas: HTMLCanvasElement;
  cx: any;

  /**
   * stores an i and j of the last user selected location within the component
   * @property {Point}
   */
  last: Interlacement;


    /**
   * stores an i and j of the last user selected location within the component
   * @property {Point}
   */
    last_point: Point;

  /**
   * triggers a class to handle disabling pointerevents when switching modes
   * @property {boolean}
   */
   pointer_events: boolean;


    /**
   * a string to represent the current user defined scale for this component to be used in background grid css. 
   * @property {striing}
   */

  scale_string: string;

  /**
   * links to the z-index to push the canvas to the front or back of view when freehand drawing. 
   */
   canvas_zndx:number &#x3D; -1;
  
  
  /**
   * stores the bounds of the shape being drawn
   */
   shape_bounds:Bounds;
  
  /**
   * stores the vtx for freehand shapes
   */
   shape_vtxs:Array&lt;Point&gt;;
  

  /**
   * trackable inputs to snackbar
   */
   snack_message:string;
   snack_bounds: Bounds;


   /**
    * a reference to the base size of each cell. Zoom in and out only modifies the view, not this base size.
    */
   default_cell_size: number &#x3D; 5;

   needs_init: boolean &#x3D; true;

   visible_op: number &#x3D; -1;

   visible_op_inlet: number &#x3D; -1;
  
  /**
   * Constructs a palette object. The palette supports drawing without components and dynamically
   * creates components from shapes and scribbles on the canvas. 
   * @param dm  a reference to the service containing the current design modes and selections
   * @param tree reference to the objects and relationships within this palette
   * @param inks a reference to the service manaing the available inks
   * @param layers a reference to the sercie managing the view layers (z-indexes) of components
   * @param resolver a reference to the factory component for dynamically generating components
   * @param fs file service for saving and loading files
   * @param _snackBar _snackBar a reference to the snackbar component that shows data on move and select
   * @param viewport reference to the window and palette variables and where the viewer is currently lookin
   * @param notes reference the service that stores all the tagged comments
   */
  constructor(
    public dm: DesignmodesService, 
    private tree: TreeService,
    private inks: InkService, 
    private layers: LayersService, 
    private resolver: ComponentFactoryResolver, 
    private fs: FileService,
    private _snackBar: MatSnackBar,
    public viewport: ViewportService,
    private notes: NotesService,
    private ss: StateService,
    private zs: ZoomService,
    private multiselect: MultiselectService) { 
    this.shape_vtxs &#x3D; [];
    this.pointer_events &#x3D; true;
  }

/**
 * Called when palette is initailized
 */
  ngOnInit(){
    this.scale_string &#x3D; this.default_cell_size+&quot;px &quot;+this.default_cell_size+&quot;px&quot;;
    this.vc.clear();
    this.default_cell_size &#x3D; defaults.mixer_cell_size; 


    
  }

  /**
   * Gets references to view items and adds to them after the view is initialized
   */
   ngAfterViewInit(){
    
    const div:HTMLElement &#x3D; document.getElementById(&#x27;scrollable-container&#x27;);
    this.viewport.set(div.offsetParent.scrollLeft, div.offsetParent.scrollTop,  div.offsetParent.clientWidth,  div.offsetParent.clientHeight);
    
    // const center:Point &#x3D; this.viewport.setViewportCenter();
    // div.offsetParent.scrollLeft &#x3D; this.viewport.getTopLeft().x;
    // div.offsetParent.scrollTop &#x3D; this.viewport.getTopLeft().y;

    this.canvas &#x3D; &lt;HTMLCanvasElement&gt; document.getElementById(&quot;scratch&quot;);
    this.cx &#x3D; this.canvas.getContext(&quot;2d&quot;);
    
    this.canvas.width &#x3D; this.viewport.getWidth();
    this.canvas.height &#x3D; this.viewport.getHeight();

    // this.cx.beginPath();
    // this.cx.rect(20, 20, this.viewport.width-40, this.viewport.height-40);
    // this.cx.stroke();

    this.selection.scale &#x3D; this.zs.zoom;

    this.selection.active &#x3D; false;
    
    this.designModeChanged();

    this.rescale(-1);

  }

  /**
   * unsubscribes to all open subscriptions and clears the view component
   */
  ngOnDestroy(){

    this.unsubscribeFromAll();
    this.vc.clear();
    
  }

  /**
   * the only way to prevent memory leaks is to unsubscribe.
   * since we lose access to tree when a new file is uploaded we must unsubscribe 
   * when any upload action is taking place. If no action takes place, then resubscribe
   */
  unsubscribeFromAll(){
    
    this.subdraftSubscriptions.forEach(element &#x3D;&gt; element.unsubscribe());
    this.operationSubscriptions.forEach(element &#x3D;&gt; element.unsubscribe());
    this.connectionSubscriptions.forEach(element &#x3D;&gt; element.unsubscribe());
    this.noteSubscriptions.forEach(element &#x3D;&gt; element.unsubscribe());
  }

  /**
   * resubscribes to each subscription
   */
  resubscribe(){

    this.tree.getDrafts().forEach(element &#x3D;&gt; {
     this.setSubdraftSubscriptions(element);
    });


    this.tree.getOperations().forEach(element &#x3D;&gt; {
      this.setOperationSubscriptions(element)
    });

    this.tree.getConnections().forEach(element &#x3D;&gt; {
    });

    this.tree.getConnections().forEach(element &#x3D;&gt; {
    });



  }

  /**
   * called when a new file is loaded
   */
   clearComponents(){
    this.unsubscribeFromAll();

    this.notes.getRefs().forEach(ref &#x3D;&gt; this.removeFromViewContainer(ref));

    this.vc.clear();
  }

  
/**
 * called when user moves position within viewer
 * @param data 
 */
  handleScroll(position: Point){
    this.viewport.setTopLeft(position);
    const div:HTMLElement &#x3D; document.getElementById(&#x27;scrollable-container&#x27;);  
     div.offsetParent.scrollLeft &#x3D; this.viewport.getTopLeft().x;
     div.offsetParent.scrollTop &#x3D; this.viewport.getTopLeft().y;
  }

/**
 * called when user moves position within viewer
 * @param data 
 */
handlePan(diff: Point){
  const div:HTMLElement &#x3D; document.getElementById(&#x27;scrollable-container&#x27;);  
  console.log(&quot;Offset &quot;, diff, div.offsetParent.scrollLeft)
   div.offsetParent.scrollLeft +&#x3D; diff.x;
   div.offsetParent.scrollTop +&#x3D; diff.y;
}



  /**
 * when someone zooms in or out, we&#x27;d like to keep the center point the same. We do this by scaling the entire palette and 
 * elements and then manually scrolling to the new center point. 
 * @param data 
 */
   handleScrollFromZoom(old_zoom: number){
    // this.viewport.setTopLeft(position);
    // console.log(old_center, this.viewport.getCenterPoint());
    const div:HTMLElement &#x3D; document.getElementById(&#x27;scrollable-container&#x27;);  
    const past_scroll_x &#x3D; div.offsetParent.scrollLeft / old_zoom;
    const new_scroll_x &#x3D; past_scroll_x * this.zs.zoom;

    const past_scroll_y &#x3D; div.offsetParent.scrollTop / old_zoom;
    const new_scroll_y &#x3D; past_scroll_y * this.zs.zoom;

     div.offsetParent.scrollLeft &#x3D; new_scroll_x;
     div.offsetParent.scrollTop &#x3D; new_scroll_y;
  }


  
  /**
 * called when user scrolls the winidow
 * @param data 
 */
   handleWindowScroll(data: any){


    const div:HTMLElement &#x3D; document.getElementById(&#x27;scrollable-container&#x27;);
    this.viewport.set(div.offsetParent.scrollLeft, div.offsetParent.scrollTop,  div.offsetParent.clientWidth,  div.offsetParent.clientHeight);
    //update the canvas to this position
  }

  /**
   * removes the view associate with this view ref
   * @param ref 
   */
  removeFromViewContainer(ref: ViewRef){
    const ndx: number &#x3D; this.vc.indexOf(ref);
    if(ndx !&#x3D;&#x3D; -1) this.vc.remove(ndx);
    else console.log(&#x27;Error: view ref not found for removal&#x27;, ref);

  }

  /**
   * adds a state to the timeline. This should be called 
   * each time a user performs an action that they should be able to undo/redo
   */
  addTimelineState(){

    // version: string,
    // workspace: any,
    // type: string,
    // nodes: Array&lt;NodeComponentProxy&gt;,
    // tree: Array&lt;TreeNodeProxy&gt;,
    // drafts: Array&lt;Draft&gt;,
    // looms: Array&lt;Loom&gt;,
    // loom_settings: Array&lt;LoomSettings&gt;
    // ops: Array&lt;any&gt;,
    // notes: Array&lt;Note&gt;,
    // materials: Array&lt;Shuttle&gt;,
    // scale: number


   this.fs.saver.ada(
      &#x27;mixer&#x27;, 
      true,
      this.zs.zoom)
      .then(so &#x3D;&gt; {
        this.ss.addMixerHistoryState(so);
      });
  }

  /**
   * this cycles through all subdrafts and calls the download call on any subdrafts
   * who are currently visible. 
   */
  async downloadVisibleDraftsAsBmp() : Promise&lt;any&gt;{

    const drafts: Array&lt;SubdraftComponent&gt; &#x3D; this.tree.getDrafts();
    const visible_drafts: Array&lt;SubdraftComponent&gt; &#x3D; drafts.filter(el &#x3D;&gt; el.draft_visible)
    const functions: Array&lt;Promise&lt;any&gt;&gt; &#x3D; visible_drafts.map(el &#x3D;&gt; el.saveAsBmp());
    return Promise.all(functions).then(el &#x3D;&gt;
      console.log(&quot;Downloaded &quot;+functions.length+&quot; files&quot;)
    );

  }
  
  /**
   * this cycles through all subdrafts and calls the download call on any subdrafts
   * who are currently visible. 
   */
   async downloadVisibleDraftsAsWif() : Promise&lt;any&gt;{

    const drafts: Array&lt;SubdraftComponent&gt; &#x3D; this.tree.getDrafts();
    const visible_drafts: Array&lt;SubdraftComponent&gt; &#x3D; drafts.filter(el &#x3D;&gt; el.draft_visible)
    const functions: Array&lt;Promise&lt;any&gt;&gt; &#x3D; visible_drafts.map(el &#x3D;&gt; el.saveAsWif());
    return Promise.all(functions)
    .then(el &#x3D;&gt;
      console.log(&quot;Downloaded &quot;+functions.length+&quot; files&quot;)
    );

  }
  


  /**
  //  * called anytime an operation is added. Adds the operation to the tree. 
  //  * @param name the name of the operation to add
  //  */
  addOperation(name:string) : number{
      
      const opcomp:OperationComponent &#x3D; this.createOperation(name);
      this.performAndUpdateDownstream(opcomp.id).then(el &#x3D;&gt; {
        this.addTimelineState();
      });

      return opcomp.id;
      
  }

   /**
  //  * called anytime an operation is added. Adds the operation to the tree. 
  //  * @param name the name of the operation to add
  //  */
  pasteOperation(opnode:OpNode) : Promise&lt;number&gt;{
      
    const opcomp:OperationComponent &#x3D; this.createOperation(opnode.name);

    const new_node &#x3D; &lt;OpNode&gt; this.tree.getNode(opcomp.id);
    new_node.inlets &#x3D; opnode.inlets.slice();
    new_node.params &#x3D; opnode.params.slice();
    new_node.component.topleft &#x3D; {x: opnode.component.topleft.x+100, y:opnode.component.topleft.y+100};

   
    return this.performAndUpdateDownstream(opcomp.id).then(el &#x3D;&gt; {

      this.addTimelineState();
      return Promise.resolve(new_node.id);
    });
    
}




  /**
   * redraws each operation and subdraft at the new scale, then redraws each of their connections
   * @param scale 
   */
  rescale(prev_zoom: number){

    //this.scale &#x3D; scale;
    const zoom_factor: number &#x3D; this.zs.zoom / this.default_cell_size;
   
     const container: HTMLElement &#x3D; document.getElementById(&#x27;palette&#x27;);
     container.style.transformOrigin &#x3D; &#x27;top left&#x27;;
     container.style.transform &#x3D; &#x27;scale(&#x27; + zoom_factor + &#x27;)&#x27;;
  
     

    //these subdrafts are all rendered independely of the canvas and need to indivdiually rescalled. This 
    //essentially rerenders (but does not redraw them) and updates their top/lefts to scaled points
    this.tree.nodes.forEach(node &#x3D;&gt; {
        if(node.type !&#x3D;&#x3D; &quot;cxn&quot;){
          node.component.scale &#x3D; this.zs.zoom;
        } 
      });


    this.tree.getConnections().forEach(sd &#x3D;&gt; {

      sd.rescale(this.zs.zoom);
    });

    this.notes.getComponents().forEach(el &#x3D;&gt; {
      el.scale &#x3D; this.zs.zoom;
    });

  

     if(this.tree.getPreview() !&#x3D;&#x3D; undefined) this.tree.getPreviewComponent().scale &#x3D; this.zs.zoom;

    this.handleScrollFromZoom(prev_zoom);

  }

  
  /**
   * loads the snackbar at the bottom of the screen
   * @param message the message to show on the snack bar
   * @param bounds the bounds of the element that we are showing info aboout
   */
  startSnackBar(message: string, bounds:Bounds){
    this.updateSnackBar(message, bounds);
    this._snackBar.openFromComponent(SnackbarComponent, {
      data: {
        message: this.snack_message,
        bounds: this.snack_bounds,
        scale: this.zs.zoom
      }
    });
  }

  snackBarAlert(message: string){
    this._snackBar.open(message, &#x27;Undo&#x27;, {
      duration: 3000
    });
  }

  /**
   * updates data shown on the snackbar
   * @param message 
   * @param bounds 
   */
  updateSnackBar(message: string, bounds:Bounds){

    this.snack_bounds &#x3D; bounds;
    this.snack_message &#x3D; message;
  }

  /**
   * called to close the snackbar
   */
  closeSnackBar(){
    this._snackBar.dismiss();
  }


  /**
   * called when the palette needs to change the design mode, emits output to parent
   * @param name - the mode to switchh to
   */
  changeDesignmode(name: string) {
    this.dm.selectDesignMode(name, &#x27;design_modes&#x27;);
    const mode &#x3D; this.dm.getDesignMode(name, &#x27;design_modes&#x27;);
    this.onDesignModeChange.emit(name);
  }

  // disablePointerEvents(){
  //   this.pointer_events &#x3D; false;
  // }

  // enablePointerEvents(){
  //   this.pointer_events &#x3D; true;
  // }

  /**
   * called when a new subdraft is created
   * @param sd 
   */
  setSubdraftSubscriptions(sd: SubdraftComponent){
    this.subdraftSubscriptions.push(sd.onSubdraftDrop.subscribe(this.subdraftDropped.bind(this)));
    this.subdraftSubscriptions.push(sd.onSubdraftMove.subscribe(this.subdraftMoved.bind(this)));
    this.subdraftSubscriptions.push(sd.onSubdraftStart.subscribe(this.subdraftStarted.bind(this)));
    this.subdraftSubscriptions.push(sd.onDeleteCalled.subscribe(this.onDeleteSubdraftCalled.bind(this)));
    this.subdraftSubscriptions.push(sd.onDuplicateCalled.subscribe(this.onDuplicateSubdraftCalled.bind(this)));
    this.subdraftSubscriptions.push(sd.onConnectionStarted.subscribe(this.onConnectionStarted.bind(this)));
    this.subdraftSubscriptions.push(sd.onDesignAction.subscribe(this.onSubdraftAction.bind(this)));
    this.subdraftSubscriptions.push(sd.onSubdraftViewChange.subscribe(this.onSubdraftViewChange.bind(this)));
    this.subdraftSubscriptions.push(sd.onNameChange.subscribe(this.onSubdraftNameChange.bind(this)));
    this.subdraftSubscriptions.push(sd.onShowDetails.subscribe(this.revealDraftDetails.bind(this)));
  }



  revealDraftDetails(id: number){
    this.onRevealDraftDetails.emit(id);
  }

  /**
   * dynamically creates a a note component
   * @returns the created note instance
   */
   createNote(note: Note):NoteComponent{

    let tl: Interlacement &#x3D; null;

    const factory &#x3D; this.resolver.resolveComponentFactory(NoteComponent);
    const notecomp &#x3D; this.vc.createComponent&lt;NoteComponent&gt;(factory);
    this.setNoteSubscriptions(notecomp.instance);

    if(note &#x3D;&#x3D;&#x3D; null || note.interlacement &#x3D;&#x3D; null){
      tl &#x3D; utilInstance.resolvePointToAbsoluteNdx(this.viewport.getCenterPoint(), this.zs.zoom);
    }else{
      tl &#x3D; note.interlacement
    }
    let id &#x3D; this.notes.createNote(tl,  notecomp.instance, notecomp.hostView, note);

    notecomp.instance.id &#x3D; id;
    notecomp.instance.scale &#x3D; this.zs.zoom;
    notecomp.instance.default_cell &#x3D; this.default_cell_size;


    this.changeDesignmode(&#x27;move&#x27;);
    return notecomp.instance;
  }


  //   /**
  //  * dynamically creates a a note component
  //  * @returns the created note instance
  //  */
  //   loadNote(note: Note):NoteComponent{

  //     console.log(&quot;LOADING NOTE&quot;, note);
  //     if(note.component &#x3D;&#x3D;&#x3D; null || note.component &#x3D;&#x3D;&#x3D; undefined){
  //       const noteinstance  &#x3D; this.createNote();
       
  
  //     }else{

  //     }
      
  //     const notecomp &#x3D; this.vc.createComponent(NoteComponent);
  //     this.setNoteSubscriptions(notecomp.instance);

  //     note.component &#x3D; notecomp.instance;
  //     note.ref &#x3D; notecomp.hostView;

  //     notecomp.instance.id &#x3D; note.id;
  //     notecomp.instance.scale &#x3D; this.zs.zoom;
  //     notecomp.instance.default_cell &#x3D; this.default_cell_size;
  
  //     return notecomp.instance;
  //   }

    
    
      /**
   * called when a new operation is added
   * @param op 
   */
  setNoteSubscriptions(note: NoteComponent){
    this.noteSubscriptions.push(note.deleteNote.subscribe(this.deleteNote.bind(this)));
    this.noteSubscriptions.push(note.saveNoteText.subscribe(this.saveNote.bind(this)));
  }

  deleteNote(id: number){
    const note &#x3D; this.notes.get(id);
    if(note &#x3D;&#x3D;&#x3D; undefined) return;
    this.removeFromViewContainer(note.ref);
    this.notes.delete(id);
  }

  saveNote(){
    this.changeDesignmode(&#x27;move&#x27;);
    this.addTimelineState();
  }



  /**
   * dynamically creates a subdraft component, adds its inputs and event listeners, pushes the subdraft to the list of references
   * @param d a Draft object for this component to contain
   * @returns the created subdraft instance
   */
  createSubDraft(d: Draft, parent: number) : Promise&lt;SubdraftComponent&gt;{
    
    const factory &#x3D; this.resolver.resolveComponentFactory(SubdraftComponent);
    const subdraft &#x3D; this.vc.createComponent&lt;SubdraftComponent&gt;(factory);
    const id &#x3D; this.tree.createNode(&#x27;draft&#x27;, subdraft.instance, subdraft.hostView);
    this.setSubdraftSubscriptions(subdraft.instance);
   
    subdraft.instance.id &#x3D; id;
    subdraft.instance.draft &#x3D; d;
    subdraft.instance.default_cell &#x3D; this.default_cell_size;
    subdraft.instance.scale &#x3D; this.zs.zoom;
    subdraft.instance.ink &#x3D; this.inks.getSelected(); //default to the currently selected ink


    return this.tree.loadDraftData({prev_id: -1, cur_id: id}, d, null, null, true)
      .then(d &#x3D;&gt; {
        return Promise.resolve(subdraft.instance);
        }
      )
  }

  createSubDraftFromEditedDetail(id: number) : Promise&lt;SubdraftComponent&gt;{
    
    const node  &#x3D; this.tree.getNode(id);
    const factory &#x3D; this.resolver.resolveComponentFactory(SubdraftComponent);
    const subdraft &#x3D; this.vc.createComponent&lt;SubdraftComponent&gt;(factory);
    this.setSubdraftSubscriptions(subdraft.instance);

    node.component &#x3D; subdraft.instance;
    node.ref &#x3D; subdraft.hostView;

    subdraft.instance.id &#x3D; id;
    subdraft.instance.draft &#x3D; this.tree.getDraft(id);
    subdraft.instance.default_cell &#x3D; this.default_cell_size;
    subdraft.instance.scale &#x3D; this.zs.zoom;
    subdraft.instance.ink &#x3D; this.inks.getSelected(); //default to the currently selected ink

    return Promise.resolve(subdraft.instance);

  }


  

  /**
   * loads a subdraft component from data
   * @param id the node id assigned to this element on load
   * @param d the draft object to load into this subdraft
   * @param nodep the component proxy used to define
   */
   loadSubDraft(id: number, d: Draft, nodep: NodeComponentProxy, draftp: DraftNodeProxy,  saved_scale: number){

    const factory &#x3D; this.resolver.resolveComponentFactory(SubdraftComponent);
    const subdraft &#x3D; this.vc.createComponent&lt;SubdraftComponent&gt;(factory);
    const node &#x3D; this.tree.getNode(id)
    node.component &#x3D; subdraft.instance;
    node.ref &#x3D; subdraft.hostView;
    this.setSubdraftSubscriptions(subdraft.instance);
    subdraft.instance.id &#x3D; id;
    subdraft.instance.default_cell &#x3D; this.default_cell_size;
    subdraft.instance.scale &#x3D; this.zs.zoom;
    subdraft.instance.draft_visible &#x3D; true;
    subdraft.instance.use_colors &#x3D; true;
    subdraft.instance.ink &#x3D; this.inks.getSelected(); //default to the currently selected ink
    subdraft.instance.draft &#x3D; d;
    subdraft.instance.parent_id &#x3D; this.tree.getSubdraftParent(id);

    if(nodep !&#x3D;&#x3D; null &amp;&amp; nodep.topleft !&#x3D;&#x3D; null){
      
      const topleft_ilace &#x3D; {j: nodep.topleft.x/saved_scale, i: nodep.topleft.y/saved_scale};
      const adj_topleft: Point &#x3D; {x: topleft_ilace.j*this.zs.zoom, y: topleft_ilace.i*this.zs.zoom};
      
    
      subdraft.instance.topleft &#x3D; adj_topleft;

      if(draftp !&#x3D;&#x3D; null &amp;&amp; draftp !&#x3D;&#x3D; undefined){
        subdraft.instance.draft_visible &#x3D; draftp.draft_visible;
      }

      if(draftp !&#x3D;&#x3D; null &amp;&amp; draftp !&#x3D;&#x3D; undefined &amp;&amp; draftp.render_colors !&#x3D;&#x3D; undefined){
        subdraft.instance.use_colors &#x3D; draftp.render_colors;
      }
    } 

  }

  setConnectionSubscriptions(cxn: ConnectionComponent){
    this.connectionSubscriptions.push(cxn.onConnectionRemoved.subscribe(this.removeConnection.bind(this)));

  }

  /**
   * called when a new operation is added
   * @param op 
   */
  setOperationSubscriptions(op: OperationComponent){
    this.operationSubscriptions.push(op.onOperationMove.subscribe(this.operationMoved.bind(this)));
    this.operationSubscriptions.push(op.onOperationMoveEnded.subscribe(this.operationMoveEnded.bind(this)));
    this.operationSubscriptions.push(op.onOperationParamChange.subscribe(this.operationParamChanged.bind(this)));
    this.operationSubscriptions.push(op.deleteOp.subscribe(this.onDeleteOperationCalled.bind(this)));
    this.operationSubscriptions.push(op.duplicateOp.subscribe(this.onDuplicateOpCalled.bind(this)));
    this.operationSubscriptions.push(op.onConnectionRemoved.subscribe(this.removeConnection.bind(this)));
    this.operationSubscriptions.push(op.onInputAdded.subscribe(this.connectionMade.bind(this)));
    this.operationSubscriptions.push(op.onInputVisibilityChange.subscribe(this.updateVisibility.bind(this)));
    this.operationSubscriptions.push(op.onInletLoaded.subscribe(this.inletLoaded.bind(this)));
    this.operationSubscriptions.push(op.onOpLoaded.subscribe(this.opCompLoaded.bind(this)));
  }


  /**
   * creates an operation component
   * @param name the name of the operation this component will perform
   * @returns the OperationComponent created
   */
    createOperation(name: string):OperationComponent{
      const factory &#x3D; this.resolver.resolveComponentFactory(OperationComponent);
      const op &#x3D; this.vc.createComponent&lt;OperationComponent&gt;(factory);
      const id &#x3D; this.tree.createNode(&#x27;op&#x27;, op.instance, op.hostView);




      this.tree.loadOpData({prev_id: -1, cur_id: id}, name, undefined, undefined);
      this.setOperationSubscriptions(op.instance);

      op.instance.name &#x3D; name;
      op.instance.id &#x3D; id;
      op.instance.zndx &#x3D; this.layers.createLayer();
      op.instance.scale &#x3D;this.zs.zoom ;
      op.instance.default_cell &#x3D; this.default_cell_size;

      const tr &#x3D;  this.viewport.getTopRight()
      op.instance.topleft &#x3D;{x: tr.x - 340, y: tr.y+120};

     



      return op.instance;
    }

    /**
   * loads an operation with the information supplied. 
   * @param name the name of the operation this component will perform
   * @params params the input data to be used in this operation
   * @returns the id of the node this has been assigned to
   */
    loadOperation(id: number, name: string, params: Array&lt;any&gt;, inlets: Array&lt;any&gt;, topleft:Point, saved_scale: number){

        const factory &#x3D; this.resolver.resolveComponentFactory(OperationComponent);
        const op &#x3D; this.vc.createComponent&lt;OperationComponent&gt;(factory);
        const node &#x3D; this.tree.getNode(id)
        node.component &#x3D; op.instance;
        node.ref &#x3D; op.hostView;
    
        this.setOperationSubscriptions(op.instance);
  
        op.instance.name &#x3D; name;
        op.instance.id &#x3D; id;
        op.instance.zndx &#x3D; this.layers.createLayer();
        op.instance.scale &#x3D; this.zs.zoom;
        op.instance.default_cell &#x3D; this.default_cell_size;
        op.instance.loaded_inputs &#x3D; params;
        op.instance.topleft &#x3D; {x: topleft.x, y: topleft.y};
        op.instance.loaded &#x3D; true;
  
        // if(bounds !&#x3D;&#x3D; null){
        
        //   const topleft_ilace &#x3D; {j: bounds.topleft.x/saved_scale, i: bounds.topleft.y/saved_scale};
        //   const adj_topleft: Point &#x3D; {x: topleft_ilace.j*this.zs.zoom, y: topleft_ilace.i*this.zs.zoom};
          
        //   const new_bounds: Bounds &#x3D; {
        //     topleft: adj_topleft,
        //     width: bounds.width / saved_scale * this.zs.zoom,
        //     height: bounds.height / saved_scale * this.zs.zoom,
        //   }
    
        //   op.instance.bounds &#x3D; new_bounds;
          
        // } 
  
       
      }

   

    /**
     * duplicates an operation with the information supplied. 
     * @param name the name of the operation this component will perform
     * @params params the input data to be used in this operation
     * @returns the id of the node this has been assigned to
     */
     duplicateOperation(name: string, params: Array&lt;number&gt;, topleft:Point, inlets: Array&lt;any&gt;):number{

      const op:OperationComponent &#x3D; this.createOperation(name);
          
          this.tree.setOpParams(op.id, params.slice(), inlets.slice());
          op.loaded_inputs &#x3D; params.slice();
          op.topleft &#x3D; {x: topleft.x, y: topleft.y};
          op.duplicated &#x3D; true;
    
          return op.id;
      }



    /**
     * creates a connection and draws it to screen
     * @param id - the id of this node
     */
     loadConnection(id: number){
      const factory &#x3D; this.resolver.resolveComponentFactory(ConnectionComponent);
      const cxn &#x3D; this.vc.createComponent&lt;ConnectionComponent&gt;(factory);
      const node &#x3D; this.tree.getNode(id);

      node.component &#x3D; cxn.instance;
      this.setConnectionSubscriptions(cxn.instance);
      node.ref &#x3D; cxn.hostView;
        
      cxn.instance.id &#x3D; id;
      cxn.instance.scale &#x3D; this.zs.zoom;
      cxn.instance.default_cell_size &#x3D; this.default_cell_size;

    }



    /**
     * creates a connection component and registers it with the tree
     * @returns the list of all id&#x27;s connected to the &quot;to&quot; node 
     */
     createConnection(id_from: number, id_to:number, to_ndx: number):{input_ids: Array&lt;number&gt;, id: number}{

      const factory &#x3D; this.resolver.resolveComponentFactory(ConnectionComponent);
      const cxn &#x3D; this.vc.createComponent&lt;ConnectionComponent&gt;(factory);
      const id &#x3D; this.tree.createNode(&#x27;cxn&#x27;, cxn.instance, cxn.hostView);
      const to_input_ids: Array&lt;number&gt; &#x3D;  this.tree.addConnection(id_from, 0, id_to, to_ndx, id);
      
      cxn.instance.id &#x3D; id;
      cxn.instance.scale &#x3D; this.zs.zoom;
      cxn.instance.default_cell_size &#x3D; this.default_cell_size;

      this.setConnectionSubscriptions(cxn.instance);


      this.connectionSubscriptions.push()
      return {input_ids: to_input_ids, id: id};
    }




  /**
   * called from upload or import events
   * @param d 
   */
  addSubdraftFromDraft(d: Draft){
    this.createSubDraft(d, -1).then(sd &#x3D;&gt; {
      sd.setPosition({x: this.viewport.getTopLeft().x + 60, y: this.viewport.getTopLeft().y + 60});
      // const interlacement &#x3D; utilInstance.resolvePointToAbsoluteNdx(sd.bounds.topleft, this.scale); 
      // this.viewport.addObj(sd.id, interlacement);
      this.addTimelineState();
    });
    
  }

  /**
  //  * called anytime an operation is added. Adds the operation to the tree. 
  //  * @param name the name of the operation to add
  //  */
  pasteSubdraft(draftnode:DraftNode): Promise&lt;number&gt;{
    //create a new idea for this draft node: 

    
    let d &#x3D; copyDraft(draftnode.draft);
    d.id &#x3D; utilInstance.generateId(8);


    return this.createSubDraft(d, -1).then(sd &#x3D;&gt; {
      sd.setPosition({x: this.viewport.getTopLeft().x + 60, y: this.viewport.getTopLeft().y + 60});
      sd.topleft &#x3D; {x: draftnode.component.topleft.x+100, y:draftnode.component.topleft.y+100};

      this.addTimelineState();
      return Promise.resolve(sd.id);
    });
    
}

  /**
   * a subdraft can only have an operation for a parent
   * removes the subdraft sent to the function
   * updates the tree view_id&#x27;s in response
   * @param id {number}  

   */
  removeSubdraft(id: number){


    if(id &#x3D;&#x3D;&#x3D; undefined) return;

    const outputs &#x3D; this.tree.getNonCxnOutputs(id);
    const delted_nodes &#x3D; this.tree.removeSubdraftNode(id);

    delted_nodes.forEach(node &#x3D;&gt; {
      this.removeFromViewContainer(node.ref);
      this.viewport.removeObj(node.id);
    })

    outputs.forEach(out &#x3D;&gt; {
      this.performAndUpdateDownstream(out);
    })

  }

  /**
   * this calls the tree to delete the operation.
   * the tree returns a list of all nodes deleted and this function updates the view to remove those elements
   * @param id 
   */
  removeOperation(id:number){


    if(id &#x3D;&#x3D;&#x3D; undefined) return;

    const drafts_out &#x3D; this.tree.getNonCxnOutputs(id);

    const outputs:Array&lt;number&gt; &#x3D; drafts_out.reduce((acc, el) &#x3D;&gt; {
      return acc.concat(this.tree.getNonCxnOutputs(el));
    }, []);


    const delted_nodes &#x3D; this.tree.removeOperationNode(id);
    delted_nodes.forEach(node &#x3D;&gt; {
      this.removeFromViewContainer(node.ref);
      this.viewport.removeObj(node.id);
    });

    outputs.forEach(out &#x3D;&gt; {
      this.performAndUpdateDownstream(out);
    })

  }

    /**
   * dynamically creates a subdraft component with specific requirements of the intersection, adds its inputs and event listeners, pushes the subdraft to the list of references
   * @param d a Draft object for this component to contain
   * @returns the created subdraft instance
   */
  createAndSetPreview(d: Draft) : Promise&lt;DraftNode&gt; {

      const factory &#x3D; this.resolver.resolveComponentFactory(SubdraftComponent);
      const subdraft &#x3D; this.vc.createComponent&lt;SubdraftComponent&gt;(factory);

      return this.tree.setPreview(subdraft, d).then( dn&#x3D;&gt; {
          //note, the preview is not added to the tree, as it will only be added if it eventually accepted by droppings
          const sd: SubdraftComponent &#x3D; &lt;SubdraftComponent&gt; dn.component;
         
          sd.id &#x3D; -1;
          sd.default_cell &#x3D; this.default_cell_size;
          sd.scale &#x3D; this.zs.zoom;
          sd.draft &#x3D; d;
          sd.ink &#x3D; this.inks.getSelected(); //default to the currently selected ink
          sd.setAsPreview();
          // sd.disableDrag();
          
          return dn;

      });


    }


  /**
   * destorys the preview component
   */
  removePreview(){

      const preview &#x3D; this.tree.getPreview();

      const ndx &#x3D; this.vc.indexOf(this.tree.getPreview().ref);
      this.vc.remove(ndx);

      this.tree.unsetPreview();
   
  }

  /**
   * Called from mixer when it receives a change from the design mode tool or keyboard press
   * triggers view mode changes required for this mode
   */
  public designModeChanged(){

    if(this.dm.getDesignMode(&#x27;move&#x27;, &#x27;design_modes&#x27;).selected){
      this.unfreezePaletteObjects();

    }else{
      console.log(&quot;DESIGN MODE CHANGED&quot;)
      this.freezePaletteObjects();
    }

    // if(this.dm.getDesignMode(&#x27;draw&#x27;, &#x27;design_modes&#x27;).selected || this.dm.getDesignMode(&#x27;shape&#x27;,  &#x27;design_modes&#x27;).selected){
    //   const old_zoom &#x3D; this.zs.zoom;
    //   this.zs.setZoom(Math.ceil(this.zs.zoom))
    //   this.rescale(old_zoom);
    // }

  }

  /**
   * specifically removes the subscription from the move event
   */
   private removeSubscription() {    
    if (this.moveSubscription) {
      this.moveSubscription.unsubscribe();
    }
  }

  /**
   * draws the selection atop the view
   * todo: update this to account for scroll
   * @param ndx 
   */
  private drawSelection(ndx: Interlacement){


    this.cx.clearRect(0, 0, this.canvas.width, this.canvas.height);

    const bounds &#x3D;{
      left: this.selection.start.j*this.zs.zoom,
      top: this.selection.start.i*this.zs.zoom,
      right: ndx.j *this.zs.zoom,
      bottom: ndx.i*this.zs.zoom
    };

    //will draw on outside of selection
    this.cx.beginPath();
    this.cx.strokeStyle &#x3D; &quot;#ff4081&quot;;
    this.cx.lineWidth &#x3D; 1;
    this.cx.setLineDash([this.zs.zoom, 2]);
    this.cx.strokeRect(bounds.left - this.viewport.getTopLeft().x, bounds.top  - this.viewport.getTopLeft().y, bounds.right-bounds.left, bounds.bottom-bounds.top);
    this.cx.fillStyle &#x3D; &quot;#ff4081&quot;;
    this.cx.font &#x3D; &quot;12px Arial&quot;;
    const w &#x3D; Math.round(this.selection.bounds.width /this.zs.zoom);
    const h &#x3D; Math.round(this.selection.bounds.height / this.zs.zoom);
    this.cx.fillText(w.toString()+&quot;x&quot;+h.toString(),  bounds.left- this.viewport.getTopLeft().x, bounds.bottom+16-this.viewport.getTopLeft().y);

  }

  /**
   * Takes an absolute index and returns it to an index relative to the viewport. 
   * @param abs 
   * @returns 
   */
  private getRelativeInterlacement(abs: Interlacement) : Interlacement {
    const i_offset: number &#x3D; Math.floor(this.viewport.getTopLeft().y / this.zs.zoom);
    const j_offset: number &#x3D; Math.floor(this.viewport.getTopLeft().x / this.zs.zoom);
    const rel: Interlacement &#x3D; {
      i: abs.i - i_offset,
      j: abs.j - j_offset,
      si: -1
    }

    return rel;
  }


  /**
   * sets the value of the scratchpad cell at ndx
   * checks for self interselcting 
   * @param ndx (i,j)
   */
  private setCell(ndx: Interlacement){

    const rel: Interlacement &#x3D; this.getRelativeInterlacement(ndx);
    let c: Cell &#x3D; this.scratch_pad[rel.i][rel.j];

    const selected: string &#x3D; this.dm.getSelectedDesignMode(&#x27;draw_modes&#x27;).value;

    switch(selected){
      case &#x27;toggle&#x27;:
        const cur: boolean &#x3D; getCellValue(c);
        if(cur &#x3D;&#x3D; null)  c &#x3D; setCellValue(c, true);
        else c &#x3D; setCellValue(c, !cur)
        break;
      case &#x27;down&#x27;:
        c &#x3D; setCellValue(c, false)
        break;
      case &#x27;up&#x27;:
        c &#x3D; setCellValue(c, true)
      break;
      case &#x27;unset&#x27;:
        c &#x3D; setCellValue(c, null);
      break;
    }


    //use the code below to use past scratchpad values, but this seems wrong
    // console.log(c);
    // const val: boolean &#x3D; c.isSet(); //check for a previous value
    // c.setHeddle(true);

    // if(val){
    //   const newval:boolean &#x3D; this.computeCellValue(this.inks.getSelected(), c, val);
    //   console.log(&quot;setting to&quot;, newval);
    //   c.setHeddle(newval);
    // } 
  }

  /**
   * called by drawcell. Draws on screen based on the current ink
   * @param ink 
   * @param over 
   * @param under 
   * @returns 
   */
  private computeCellColor(ink: string, over: Cell, under: boolean): string{

    const res: boolean &#x3D; this.computeCellValue(ink, over, under);
    if(ink &#x3D;&#x3D;&#x3D; &#x27;unset&#x27; &amp;&amp; res &#x3D;&#x3D; true) return &quot;#cccccc&quot;; 
    if(res &#x3D;&#x3D;&#x3D;null) return &quot;#fafafa&quot;;
    if(res) return &quot;#000000&quot;;
    return &quot;#ffffff&quot;;      
  }

  /**
   * applies the filter betetween over and under and returns the result
   * @param ink the ink with which to compute the transition
   * @param over the value of the primary (top) cell
   * @param under the value of the intersecting (bottom) cell 
   * @returns 
   */
  private computeCellValue(ink: string, over: Cell, under: boolean): boolean{
    
    let res: boolean &#x3D; utilInstance.computeFilter(ink, getCellValue(over), under);
    return res;   
  }

  /**
   * called when creating a subdraft from the drawing on the screen. Computes the resulting value based on
   * all intersections with the drawing
   * @param ndx the i,j location of the cell we are checking
   * @param ink the currently selected ink
   * @param over the Cell we are checking against
   * @returns true/false or null
   */
  private getScratchpadProduct(ndx: Interlacement, ink: string, over: Cell): boolean{
    
    switch(ink){
      case &#x27;neq&#x27;:
      case &#x27;and&#x27;:
      case &#x27;or&#x27;:

        const p &#x3D; {x: ndx.j *this.zs.zoom, y: ndx.i * this.zs.zoom};
        // const isect &#x3D; this.getIntersectingSubdraftsForPoint(p);
  
        // if(isect.length &gt; 0){
        //   const prev: boolean &#x3D; isect[0].resolveToValue(p);
        //   return this.computeCellValue(ink, over, prev);
        // }else{
        //   return this.computeCellValue(ink, over, null);
        // }
      break;

      default: 
        return this.computeCellValue(ink, over, null);
      break;
    }
   return null; 
  }
 

  /**
   * draw the cell at position ndx
   * @param ndx (i,j)
   */
  private drawCell(ndx: Interlacement){

    const rel: Interlacement &#x3D; this.getRelativeInterlacement(ndx);
    const c: Cell &#x3D; this.scratch_pad[rel.i][rel.j];
    this.cx.fillStyle &#x3D; &quot;#cccccc&quot;;
  
    const selected_ink:string &#x3D; this.inks.getSelected();

    switch(selected_ink){
      case &#x27;neq&#x27;:
      case &#x27;and&#x27;:
      case &#x27;or&#x27;:

        const p &#x3D; {x: ndx.j * this.zs.zoom, y: ndx.i * this.zs.zoom};
        // const isect &#x3D; this.getIntersectingSubdraftsForPoint(p);

        // if(isect.length &gt; 0){
        //   const prev: boolean &#x3D; isect[0].resolveToValue(p);
        //   this.cx.fillStyle &#x3D; this.computeCellColor(selected_ink, c, prev);
        // }else{
        //   this.cx.fillStyle &#x3D;  this.computeCellColor(selected_ink, c, null);;
        // }
      break;

      default: 
        this.cx.fillStyle &#x3D; this.computeCellColor(selected_ink, c, null);
      break;

    }

      this.cx.fillRect(rel.j*this.zs.zoom, rel.i*this.zs.zoom, this.zs.zoom, this.zs.zoom);      
  }

  /**
   * Deletes the subdraft that called this function.
   */
    onDeleteSubdraftCalled(obj: any){
      
      if(obj &#x3D;&#x3D;&#x3D; null) return;
      this.removeSubdraft(obj.id);
      this.addTimelineState();
   }

     /**
   * Deletes the subdraft that called this function.
   */
      onDeleteOperationCalled(obj: any){
      
        if(obj &#x3D;&#x3D;&#x3D; null) return;
        this.removeOperation(obj.id);
        this.addTimelineState();
     }

   /**
   * Duplicates the operation that called this function.
   */
    onDuplicateOpCalled(obj: any){
      if(obj &#x3D;&#x3D;&#x3D; null) return;

      const op &#x3D; this.tree.getOpNode(obj.id);
      const op_comp &#x3D; &lt;OperationComponent&gt; this.tree.getComponent(obj.id);


      let new_tl: Point &#x3D; null;


      if(this.tree.hasSingleChild(obj.id) &amp;&amp; this.tree.opHasHiddenChild(obj.id)){
          new_tl &#x3D; {x: op_comp.topleft.x + 200, y: op_comp.topleft.y}
      }else{
        let container &#x3D; document.getElementById(&#x27;scale-&#x27;+obj.id);
          new_tl &#x3D;  {x: op_comp.topleft.x + 10 + container.offsetWidth*this.zs.zoom/this.default_cell_size, y: op_comp.topleft.y}
      }


      const id: number &#x3D; this.duplicateOperation(op.name, op.params, new_tl, op.inlets);
      const new_op &#x3D; &lt;OperationComponent&gt; this.tree.getComponent(id);

      //duplicate the connections as well
      const cxns &#x3D; this.tree.getInputsWithNdx(op.id);
      cxns.forEach(cxn &#x3D;&gt; {
        if(cxn.tn.inputs.length &gt; 0){
        const from &#x3D; cxn.tn.inputs[0].tn.node.id;
        this.createConnection(from, new_op.id, cxn.ndx);
        }
      })



      this.operationParamChanged({id: id});
      this.addTimelineState();
 }

 /**
  This is called when the finetune mode is closed and we need to create a new subdraft to hold the changes. 
  * @param obj {parent_id, new_id}
  * @returns 
  */
  // createNewSubdraftFromEdits(obj: any){
  //   this.changeDesignmode(&#x27;move&#x27;)

  //   if(obj &#x3D;&#x3D;&#x3D; null) return;

  //   const sd &#x3D; &lt;SubdraftComponent&gt; this.tree.getComponent(obj.parent_id);
  //   const new_draft &#x3D; this.tree.getDraft(obj.new_id);
  //   const new_loom &#x3D; this.tree.getLoom(obj.new_id);
  //   const new_ls &#x3D; this.tree.getLoomSettings(obj.new_id);
  //   const new_topleft &#x3D; {
  //       x: sd.topleft.x + 40 + this.zs.zoom *2, 
  //       y: sd.topleft.y}

    


  //   this.loadSubDraft(
  //     obj.new_id, 
  //     new_draft, 
  //     {
  //       node_id: obj.new_id,
  //       type: &#x27;draft&#x27;,
  //       topleft: sd.topleft
  //     },
  //     {
  //       node_id: obj.new_id,
  //       draft_id: new_draft.id,
  //       draft_name: new_draft.ud_name,
  //       draft: new_draft,
  //       draft_visible: true,
  //       loom: new_loom,
  //       loom_settings:new_ls,
  //       render_colors: true
  //     },
  //     this.zs.zoom);
  //     this.addTimelineState();

   
  //  }


    onDuplicateSubdraftCalled(obj: any){
        if(obj &#x3D;&#x3D;&#x3D; null) return;

        const sd &#x3D; &lt;SubdraftComponent&gt; this.tree.getComponent(obj.id);
        const sd_draft &#x3D; &lt;Draft&gt; this.tree.getDraft(obj.id);
        

      this.createSubDraft(initDraftWithParams(
        {wefts: wefts(sd_draft.drawdown), 
          warps: warps(sd_draft.drawdown), 
          drawdown: sd_draft.drawdown.slice(), 
          rowShuttleMapping: sd_draft.rowShuttleMapping.slice(),
          colShuttleMapping: sd_draft.colShuttleMapping.slice(),
          rowSystemMapping: sd_draft.rowSystemMapping.slice(),
          colSystemMapping: sd_draft.colSystemMapping.slice(),
          gen_name: getDraftName(sd_draft)+&quot; copy&quot;
        }), -1)
        .then(new_sd &#x3D;&gt; {

          const orig_size &#x3D; document.getElementById(&#x27;scale-&#x27;+obj.id);

          new_sd.setPosition({
            x: sd.topleft.x + orig_size.offsetWidth*(this.zs.zoom/this.default_cell_size) + this.zs.zoom *2, 
            y: sd.topleft.y});  
          //const interlacement &#x3D; utilInstance.resolvePointToAbsoluteNdx(new_sd.bounds.topleft, this.scale); 
          //this.viewport.addObj(new_sd.id, interlacement);
          this.addTimelineState();
        }).catch(console.error);
       
   }

  /**
   * A mouse event, originated in a subdraft, has been started
   * checkes the design mode and handles the event as required
   * @param obj contains the id of the moving subdraft
   */
  subdraftStarted(obj: any){
    if(obj &#x3D;&#x3D;&#x3D; null) return;

    if(this.dm.isSelected(&quot;move&quot;,  &#x27;design_modes&#x27;)){
  
      //get the reference to the draft that&#x27;s moving
      const moving &#x3D; &lt;SubdraftComponent&gt; this.tree.getComponent(obj.id);
      
      if(moving &#x3D;&#x3D;&#x3D; null) return; 


      // // this.startSnackBar(&quot;Using Ink: &quot;+moving.ink, null);
      
      // const isect:Array&lt;SubdraftComponent&gt; &#x3D; this.getIntersectingSubdrafts(moving);
      // const seed_drafts &#x3D; isect.filter(el &#x3D;&gt; !this.tree.hasParent(el.id)); //filter out drafts that were generated

      // if(seed_drafts.length &#x3D;&#x3D;&#x3D; 0) return;
      
      // const bounds: any &#x3D; utilInstance.getCombinedBounds(moving, seed_drafts);
      // const temp: Draft &#x3D; this.getCombinedDraft(bounds, moving, seed_drafts);



      // this.createAndSetPreview(temp).then(dn &#x3D;&gt; {
      //   this.tree.getPreviewComponent().setPosition(bounds.topleft);
      // }).catch(console.error);
      
    }else if(this.dm.isSelected(&quot;marquee&quot;,  &#x27;design_modes&#x27;)){
      this.selectionStarted();
    }else if(this.dm.isSelected(&quot;draw&quot;,  &#x27;design_modes&#x27;)){
      this.drawStarted();
    }

 }

 /**
  * triggers a mode that allows mouse-mouse to be followed by a line.
  * todo; add code that holds the point on scroll
  * @param obj - contains event, id of component who called
  */
 onConnectionStarted(obj: any){

  if(obj.type &#x3D;&#x3D; &#x27;stop&#x27;){
    this.selecting_connection &#x3D; false;
    this.tree.unsetOpenConnection();
    this.processConnectionEnd();
    return;
  }


  const valid &#x3D; this.tree.setOpenConnection(obj.id);
  if(!valid) return;

  this.changeDesignmode(&#x27;operation&#x27;);
  this.selecting_connection &#x3D; true;

  //make sure to unselect anything else that had previously been selected
  const all_drafts &#x3D; this.tree.getDraftNodes();
  const not_selected &#x3D; all_drafts.filter(el &#x3D;&gt; el.id !&#x3D;&#x3D; obj.id);
  not_selected.forEach(node &#x3D;&gt; {
    let comp &#x3D; &lt;SubdraftComponent&gt;node.component;
    comp.selecting_connection &#x3D; false;
  })



  const sd: SubdraftComponent &#x3D; &lt;SubdraftComponent&gt; this.tree.getComponent(obj.id);

  let adj: Point;

  if(sd.draft_visible){
    const from &#x3D; document.getElementById(&#x27;scale-&#x27;+obj.id);
   adj &#x3D; {
    x: sd.topleft.x - this.viewport.getTopLeft().x + 8, 
    y: (sd.topleft.y+from.offsetHeight*(this.zs.zoom/this.default_cell_size)) - this.viewport.getTopLeft().y}
   }else{
   adj &#x3D; {
    x: sd.topleft.x - this.viewport.getTopLeft().x + 10, 
    y: (sd.topleft.y) - this.viewport.getTopLeft().y}
   }

  this.unfreezePaletteObjects();

  this.shape_bounds &#x3D; {
    topleft: adj,
    width: this.zs.zoom,
    height: this.zs.zoom
  };

  this.startSnackBar(&quot;select an input or click an empty space to stop selecting&quot;, null);

 }






 /**
 * adds a connector flag to any subdrafts that we are allowed to connect to from this operation
 */
  // setDraftsConnectable(op_id: number){
  //   const nodes: Array&lt;SubdraftComponent&gt; &#x3D; this.tree.getDrafts();
  //   const op: OperationComponent &#x3D; &lt;OperationComponent&gt; this.tree.getComponent(op_id);
  //   const inputs: Array&lt;number&gt; &#x3D; this.tree.getInputs(op_id);
  //   if(inputs.length &gt;&#x3D; op.maxInputs()){
  //     nodes.forEach(el &#x3D;&gt; {
  //       el.unsetConnectable();

  //       //now unset the ones that are already assigned to other ops
  //       const connections: Array&lt;number&gt; &#x3D; this.tree.getNonCxnOutputs(el.id);
  //       const op_ndx: number &#x3D; connections.findIndex(id &#x3D;&gt; (id &#x3D;&#x3D;&#x3D; op_id));
  //       //if it had connections and the connection was not this operation, unset it
  //       if(op_ndx !&#x3D;&#x3D; -1){
  //         el.setConnectable();
  //       }    
  //     });
  //   }else{

  //     nodes.forEach(el &#x3D;&gt; {

  //       //look upstream to see if this operation is linked in any way to this op
  //       const upstream: Array&lt;number&gt; &#x3D; this.tree.getUpstreamOperations(el.id);
  //       const ndx: number &#x3D; upstream.findIndex(i &#x3D;&gt; i &#x3D;&#x3D;&#x3D; op_id);
  //       if(ndx &#x3D;&#x3D;&#x3D; -1) el.setConnectable();
  
  //       //now unset the ones that are already assigned to other ops
  //       const connections: Array&lt;number&gt; &#x3D; this.tree.getOutputs(el.id);
  //       const ops: Array&lt;number&gt; &#x3D; connections.map(cxn &#x3D;&gt; this.tree.getConnectionOutput(cxn));
  //       const op_ndx: number &#x3D; ops.findIndex(op &#x3D;&gt; (op &#x3D;&#x3D;&#x3D; op_id));
  //       //if it had connections and the connection was not this operation, unset it
  //       if(ops.length &gt; 0 &amp;&amp; op_ndx &#x3D;&#x3D;&#x3D; -1){
  //         el.unsetConnectable();
  //       }    
  
  //     });
  //   }

  //   const ops: Array&lt;OperationComponent&gt; &#x3D; this.tree.getOperations();
  //   ops.forEach(op &#x3D;&gt; {
  //     if(op.id !&#x3D; op_id) op.active_connection &#x3D; true;
  //   });
   
  //  }

    /**
 * disables selection and pointer events on all
 */
  // unsetDraftsConnectable(){
  //   const nodes: Array&lt;SubdraftComponent&gt; &#x3D; this.tree.getDrafts();
  //   nodes.forEach(el &#x3D;&gt; {
  //     el.unsetConnectable();
  //   });

  //   const ops: Array&lt;OperationComponent&gt; &#x3D; this.tree.getOperations();
  //   ops.forEach(op &#x3D;&gt; {
  //     op.active_connection &#x3D; false;
  //   });

  //  }

/**
 * disables selection and pointer events on all
 */
 freezePaletteObjects(){
  const nodes: Array&lt;any&gt; &#x3D; this.tree.getComponents();
  nodes.forEach(el &#x3D;&gt; {
    el.disableDrag();
  });

  const notes: Array&lt;any&gt; &#x3D; this.notes.getComponents();
  notes.forEach(el &#x3D;&gt; {
    el.disableDrag();
  });
 }

 /**
 * unfreezes all palette objects (except connections)
 */
  unfreezePaletteObjects(){
    const nodes: Array&lt;any&gt; &#x3D; this.tree.getComponents();
    nodes.forEach(el &#x3D;&gt; {
      if(el !&#x3D; null){
        el.enableDrag();
      } 
    });

    const notes: Array&lt;any&gt; &#x3D; this.notes.getComponents();
    notes.forEach(el &#x3D;&gt; {
      el.enableDrag();
    });
   }
  

   /**
    * this is called when an subdraft updates its show/hide value
    */
   onSubdraftViewChange(id: number){

    this.updateAttachedComponents(id, false);

   }

      /**
    * this is called when an subdraft updates its show/hide value
    */
    onSubdraftNameChange(id: number){

      const outs &#x3D; this.tree.getNonCxnOutputs(id);
      const to_perform &#x3D; outs.map(el &#x3D;&gt; this.performAndUpdateDownstream(el));
      return Promise.all(to_perform) 
      .then(el &#x3D;&gt; 
        {
          this.addTimelineState(); 
        })
        .catch(console.error);;

       
    }
    


 /**
   * draws when a user is using the mouse to identify an input to a component
   * @param mouse the absolute position of the mouse on screen
   * @param shift boolean representing if shift is pressed as well 
   */
connectionDragged(mouse: Point, shift: boolean){

  //get the mouse position relative to the view frame
  const adj: Point &#x3D; {x: mouse.x - this.viewport.getTopLeft().x, y: mouse.y - this.viewport.getTopLeft().y}
  this.shape_bounds.width &#x3D;  (adj.x - this.shape_bounds.topleft.x);
  this.shape_bounds.height &#x3D;  (adj.y - this.shape_bounds.topleft.y);


  const svg &#x3D; document.getElementById(&#x27;scratch_svg&#x27;);
  svg.style.top &#x3D; (this.viewport.getTopLeft().y+this.shape_bounds.topleft.y)+&quot;px&quot;;
  svg.style.left &#x3D; (this.viewport.getTopLeft().x+this.shape_bounds.topleft.x)+&quot;px&quot;

 
  svg.innerHTML &#x3D; &#x27; &lt;path d&#x3D;&quot;M 0 0 C 0 50,&#x27;
  +(this.shape_bounds.width)+&#x27; &#x27;
  +(this.shape_bounds.height-50)+&#x27;, &#x27;
  +(this.shape_bounds.width)+&#x27; &#x27;
  +(this.shape_bounds.height)
  +&#x27;&quot; fill&#x3D;&quot;transparent&quot; stroke&#x3D;&quot;#ff4081&quot;  stroke-dasharray&#x3D;&quot;4 2&quot;  stroke-width&#x3D;&quot;2&quot;/&gt; &#x27; ;

 

}


/**
 * resets the view when a connection event ends
 */
 processConnectionEnd(){
  this.closeSnackBar();
  this.selecting_connection &#x3D; false;
  const svg &#x3D; document.getElementById(&#x27;scratch_svg&#x27;);
  svg.innerHTML &#x3D; &#x27; &#x27; ;

  this.cx.clearRect(0, 0, this.canvas.width, this.canvas.height);
  this.changeDesignmode(&#x27;move&#x27;);

  if(!this.tree.hasOpenConnection()) return;

  
  const sd: SubdraftComponent &#x3D; this.tree.getOpenConnection();
  if(sd !&#x3D;&#x3D; null) sd.connectionEnded();
  this.tree.unsetOpenConnection();
} 


/**
 * calculates the default topleft position for this node based on the width and size of its parent and/or neighbors
 * @param id the id of the component to position
 * @returns a promise for the updated point
 */
calculateInitialLocaiton(id: number) : Point {
  
  console.log(&quot;CALC INIT LOCATION&quot;)

  let new_tl &#x3D;  this.viewport.getTopLeft(); 
  

  //if it has a parent, align it to the bottom edge
  if(this.tree.hasParent(id)){

    const parent_id &#x3D; this.tree.getSubdraftParent(id);
    const opnode &#x3D; this.tree.getNode(parent_id);
    const topleft &#x3D; opnode.component.topleft;

    const container: HTMLElement &#x3D; document.getElementById(&#x27;scale-&#x27;+parent_id);

    //this component was just generated and needs a postion
    if(container &#x3D;&#x3D; null){
      new_tl &#x3D; {x: topleft.x, y: topleft.y};


      // //component is not yet initalized on this calculation so we do it manually
      const default_height &#x3D;  100 * this.zs.zoom/this.default_cell_size;
      new_tl &#x3D; {x: topleft.x, y: topleft.y+default_height};

    }else{

      const container: HTMLElement &#x3D; document.getElementById(&#x27;scale-&#x27;+parent_id);
      console.log(&quot;scale-&quot;, parent_id, container)
      const parent_height &#x3D; container.offsetHeight * (this.zs.zoom/this.default_cell_size);  
      new_tl &#x3D; {x: topleft.x, y: topleft.y + parent_height};
    }

    const outs &#x3D; this.tree.getNonCxnOutputs(parent_id);
    if(outs.length &gt; 1){
      const this_child &#x3D; outs.findIndex(el &#x3D;&gt; el &#x3D;&#x3D;&#x3D; id);
      if(this_child &#x3D;&#x3D;&#x3D; -1){ console.error(&quot;subdraft not found in parent output list&quot;)};
      
      const updated_point: Point &#x3D; outs
      .filter((el, ndx) &#x3D;&gt; (ndx &lt; this_child))
      .reduce((acc, el, ndx) &#x3D;&gt; {
        const el_draft &#x3D; this.tree.getDraft(el);
         acc.x &#x3D; acc.x + (warps(el_draft.drawdown) + 2)*this.default_cell_size;
         return acc;
      }, topleft);
      
      new_tl &#x3D; updated_point;

    }

  }
  return new_tl;
}




/**
 * this calls a function for an operation to perform and then subsequently calls all children 
 * to recalculate. After each calculation, it redraws and or creates any new subdrafts
 * @param op_id 
 * @returns 
 */
performAndUpdateDownstream(op_id:number) : Promise&lt;any&gt;{

  this.tree.getOpNode(op_id).dirty &#x3D; true;
  this.tree.getDownstreamOperations(op_id).forEach(el &#x3D;&gt; this.tree.getNode(el).dirty &#x3D; true);

  return this.tree.performGenerationOps([op_id])
  .then(draft_ids &#x3D;&gt; {

    const fns &#x3D; this.tree.getDraftNodes()
      .filter(el &#x3D;&gt; el.component !&#x3D;&#x3D; null &amp;&amp; el.dirty)
      .map(el &#x3D;&gt; (&lt;SubdraftComponent&gt; el.component).drawDraft((&lt;DraftNode&gt;el).draft));



    //create any new subdrafts nodes
    const new_drafts &#x3D; this.tree.getDraftNodes()
      .filter(el &#x3D;&gt; el.component &#x3D;&#x3D;&#x3D; null)
      .map(el &#x3D;&gt; {
        //console.log(&quot;loading new subdraft&quot;, (&lt;DraftNode&gt;el).draft);
        return this.loadSubDraft(
          el.id, 
          (&lt;DraftNode&gt;el).draft, 
          {
            node_id: el.id,
            type: el.type,
            topleft: this.calculateInitialLocaiton(el.id),
          }, null,this.zs.zoom);
        });
      

        return  Promise.all([Promise.all(fns), Promise.all(new_drafts)]);
        
       
  }).then(el &#x3D;&gt; {
    const loads &#x3D;[];
    const new_cxns &#x3D; this.tree.nodes.filter(el &#x3D;&gt; el.type &#x3D;&#x3D;&#x3D; &#x27;cxn&#x27; &amp;&amp; el.component &#x3D;&#x3D;&#x3D; null);   
    new_cxns.forEach(cxn &#x3D;&gt; {
      const from_node:Array&lt;number&gt; &#x3D; this.tree.getInputs(cxn.id);
      const to_node:Array&lt;number&gt; &#x3D; this.tree.getOutputs(cxn.id);
      if(from_node.length !&#x3D;&#x3D; 1 || to_node.length !&#x3D;&#x3D; 1) Promise.reject(&quot;connection has zero or more than one input or output&quot;);
      loads.push(this.loadConnection(cxn.id));
    })

    //update the positions of the connections
    let all_cxns &#x3D; this.tree.getConnections();
    all_cxns.forEach(cxn &#x3D;&gt; {
      let to &#x3D; this.tree.getOutputs(cxn.id);
      to.forEach(id &#x3D;&gt; {
        cxn.updateToPosition(id, this.zs.zoom)
      })
    })

    return Promise.all(loads);

    }
  );

}

/**
 * when a subdraft is closed, it has no operation to run before updaing downstream, instead it ONLY needs to update the downstream values
 * @param subdraft_id 
 */
updateDownstream(subdraft_id: number) {

  let out &#x3D; this.tree.getNonCxnOutputs(subdraft_id);
  console.log(&quot;out &quot;, out)
  
  out.forEach(op_id &#x3D;&gt; {
    this.tree.getOpNode(op_id).dirty &#x3D; true;
    this.tree.getDownstreamOperations(op_id).forEach(el &#x3D;&gt; this.tree.getNode(el).dirty &#x3D; true);  
  })

 
  return this.tree.performGenerationOps(out)
  .then(draft_ids &#x3D;&gt; {

    const fns &#x3D; this.tree.getDraftNodes()
      .filter(el &#x3D;&gt; el.component !&#x3D;&#x3D; null &amp;&amp; el.dirty)
      .map(el &#x3D;&gt; (&lt;SubdraftComponent&gt; el.component).drawDraft((&lt;DraftNode&gt;el).draft));



    //create any new subdrafts nodes
    const new_drafts &#x3D; this.tree.getDraftNodes()
      .filter(el &#x3D;&gt; el.component &#x3D;&#x3D;&#x3D; null)
      .map(el &#x3D;&gt; {
        //console.log(&quot;loading new subdraft&quot;, (&lt;DraftNode&gt;el).draft);
        return this.loadSubDraft(
          el.id, 
          (&lt;DraftNode&gt;el).draft, 
          {
            node_id: el.id,
            type: el.type,
            topleft: this.calculateInitialLocaiton(el.id),
          }, null,this.zs.zoom);
        });
      

        return  Promise.all([Promise.all(fns), Promise.all(new_drafts)]);
        
       
  }).then(el &#x3D;&gt; {
    const loads &#x3D;[];
    const new_cxns &#x3D; this.tree.nodes.filter(el &#x3D;&gt; el.type &#x3D;&#x3D;&#x3D; &#x27;cxn&#x27; &amp;&amp; el.component &#x3D;&#x3D;&#x3D; null);   
    new_cxns.forEach(cxn &#x3D;&gt; {
      const from_node:Array&lt;number&gt; &#x3D; this.tree.getInputs(cxn.id);
      const to_node:Array&lt;number&gt; &#x3D; this.tree.getOutputs(cxn.id);
      if(from_node.length !&#x3D;&#x3D; 1 || to_node.length !&#x3D;&#x3D; 1) Promise.reject(&quot;connection has zero or more than one input or output&quot;);
      loads.push(this.loadConnection(cxn.id));
    })

    return Promise.all(loads);

    }
  );

}

 
/**
 * when an inlet is pressed on an operation, highlight all things contributed to this inlet
 * @param op_id 
 * @param inlet_id 
 * @param ndx_in_inlets - if there aremultiple inputs at a single inlet, give the number in that list
 */
highlightPathToInlet(op_id: number, inlet_id: number, ndx_in_inlets: number){

const cxns &#x3D; this.tree.getInputsAtNdx(op_id, inlet_id);
const upstream_ops &#x3D; this.tree.getUpstreamOperations(cxns[ndx_in_inlets].tn.node.id); 
const upstream_drafts &#x3D; this.tree.getUpstreamDrafts(cxns[ndx_in_inlets].tn.node.id); 

// const upstream_ops &#x3D; cxns.reduce((acc, val)&#x3D;&gt;{
//    const ids &#x3D; this.tree.getUpstreamOperations(val.tn.node.id);
//    return acc.concat(ids);
//  }, []); 

// const upstream_drafts &#x3D; cxns.reduce((acc, val)&#x3D;&gt;{
//   const ids &#x3D; this.tree.getUpstreamDrafts(val.tn.node.id);
//   return acc.concat(ids);
// }, []); 

const upstream_cxn &#x3D; upstream_drafts.reduce((acc, draft)&#x3D;&gt;{
  return acc.concat(this.tree.getOutputs(draft));
}, []); 



//  const upstream_drafts &#x3D; this.tree.getUpstreamDrafts(op_id);
const op_children &#x3D; this.tree.getNonCxnOutputs(op_id);

 const all_ops &#x3D; this.tree.getOpNodes();
 all_ops.forEach(op &#x3D;&gt; {
  if(upstream_ops.find(el &#x3D;&gt; el &#x3D;&#x3D;&#x3D; op.id) &#x3D;&#x3D;&#x3D; undefined){
    if(op.id !&#x3D;&#x3D; op_id){
      const div &#x3D; document.getElementById(&quot;scale-&quot;+op.id);
      if(div !&#x3D;&#x3D; null) div.style.opacity &#x3D; &quot;.2&quot;;
    } 
  }
 })

 const all_drafts &#x3D; this.tree.getDraftNodes();
 all_drafts.forEach(draft &#x3D;&gt; {
  if(upstream_drafts.find(el &#x3D;&gt; el &#x3D;&#x3D;&#x3D; draft.id) &#x3D;&#x3D;&#x3D; undefined){
    if(op_children.find(del &#x3D;&gt; del &#x3D;&#x3D;&#x3D; draft.id) &#x3D;&#x3D;&#x3D; undefined){
      const div &#x3D; document.getElementById(&quot;scale-&quot;+draft.id);
      if(div !&#x3D;&#x3D; null) div.style.opacity &#x3D; &quot;.2&quot;;
    } 
  }
 })

 const all_cxns &#x3D; this.tree.getConnections();
 all_cxns.forEach(cxn &#x3D;&gt; {
  if(upstream_cxn.find(el &#x3D;&gt; el &#x3D;&#x3D;&#x3D; cxn.id) &#x3D;&#x3D;&#x3D; undefined){
    const div &#x3D; document.getElementById(&quot;scale-&quot;+cxn.id);
    if(div !&#x3D;&#x3D; null) div.style.opacity &#x3D; &quot;.2&quot;;
  }else{
    cxn.show_path_text &#x3D; true;
    cxn.drawConnection(this.zs.zoom);
  }
 })

}

resetOpacity(){
  const ops &#x3D; this.tree.getOpNodes();
  ops.forEach(op &#x3D;&gt; {
    const div &#x3D; document.getElementById(&quot;scale-&quot;+op.id);
    if(div !&#x3D;&#x3D; null) div.style.opacity &#x3D; &quot;1&quot;
  });

  const drafts &#x3D; this.tree.getDraftNodes();
  drafts.forEach(draft &#x3D;&gt; {
    const div &#x3D; document.getElementById(&quot;scale-&quot;+draft.id);
    if(div !&#x3D;&#x3D; null) div.style.opacity &#x3D; &quot;1&quot;
  });

  const cxns &#x3D; this.tree.getConnections();
  cxns.forEach(cxn &#x3D;&gt; {
    const div &#x3D; document.getElementById(&quot;scale-&quot;+cxn.id);
    if(div !&#x3D;&#x3D; null)  div.style.opacity &#x3D; &quot;1&quot;
    cxn.show_path_text &#x3D; false;
    cxn.drawConnection(this.zs.zoom);

  });

  
}



/**
 * called from an operation or inlet to allow for the inlighting of all upstream operations and drafts
 * @param obj 
 */
updateVisibility(obj: any){
  {

    this.resetOpacity();
    if(obj.show &#x3D;&#x3D; true){

      //unset any no longer selected inlets
      const ops:Array&lt;OpNode&gt; &#x3D; this.tree.getOpNodes();
      const not_selected &#x3D; ops.filter(el &#x3D;&gt; el.id !&#x3D;&#x3D; obj.id);


      not_selected.forEach((op, ndx) &#x3D;&gt; {
        const inlets &#x3D; op.inlets.map((val, ndx)&#x3D;&gt; ndx);
        (&lt;OperationComponent&gt;op.component).resetVisibliity(inlets);
      })

      let selected &#x3D; ops.filter(el &#x3D;&gt; el.id &#x3D;&#x3D; obj.id);
      if(selected.length &gt; 0){
        const inlets &#x3D; selected[0].inlets.map((val, ndx)&#x3D;&gt; ndx).filter(el &#x3D;&gt; el !&#x3D;&#x3D; obj.ndx);
        (&lt;OperationComponent&gt;selected[0].component).resetVisibliity(inlets);
      }


      this.highlightPathToInlet(obj.id, obj.ndx, obj.ndx_in_inlets);


    }else{
      this.visible_op &#x3D; -1;
      this.visible_op_inlet &#x3D; -1;
    }

  } 
}

/**
 * called from an operation or inlet to allow for the inlighting of all upstream operations and drafts
 * @param obj 
 */
inletLoaded(obj: any){
  //redraw the inlet
  // let opid &#x3D; obj.opid;
  // let ndx &#x3D; obj.ndx;

  // const opnode &#x3D; this.tree.getOpNode(opid);
  // const cxns &#x3D; this.tree.getInputsAtNdx(opnode.id, ndx);
  // // console.log(&quot;CXNS &quot;, cxns);
  // cxns.forEach(io &#x3D;&gt; {
  //   const cxn &#x3D; &lt;ConnectionComponent&gt; this.tree.getComponent(io.tn.node.id);
  //   // console.log(&quot;ATTEMPTING TO UPDATE TO POSITION &quot;)
  //   cxn.updateToPosition(opnode.id, this.zs.zoom)
  // })
}

/**
 * called from an operation or inlet to allow for the inlighting of all upstream operations and drafts
 * @param obj 
 */
opCompLoaded(obj: any){
  //redraw the inlet
  let opid &#x3D; obj.id;

  const cxns &#x3D; this.tree.getInputsWithNdx(opid);

  cxns.forEach((cxn, input_ndx) &#x3D;&gt; {
    const cxn_comp &#x3D; &lt;ConnectionComponent&gt;this.tree.getComponent(cxn.tn.node.id)
    cxn_comp.updateToPosition(opid,this.zs.zoom)
  })





}




/**
 * emitted from operation when it receives a hit on its connection button, the id refers to the operation id
 */
connectionMade(obj: any){


  if(!this.tree.hasOpenConnection()) return;


  //this is defined in the order that the line was drawn
  const op:OperationComponent &#x3D; &lt;OperationComponent&gt;this.tree.getComponent(obj.id);
  const sd: SubdraftComponent &#x3D; &lt;SubdraftComponent&gt; this.tree.getOpenConnection();
  
  this.createConnection(sd.id, obj.id, obj.ndx);
  
  this.performAndUpdateDownstream(obj.id).then(el &#x3D;&gt; {
    this.addTimelineState();
  });

  this.processConnectionEnd();

}

pasteConnection(from: number, to: number, inlet: number){

  this.createConnection(from, to, inlet);

  this.performAndUpdateDownstream(to).then(el &#x3D;&gt; {
    this.addTimelineState();
  });

}

/**
 * Called when a connection is explicitly deleted
*/
 removeConnection(obj: {id: number}){

  let to &#x3D; this.tree.getConnectionOutput(obj.id)

  const to_delete &#x3D; this.tree.removeConnectionNodeById(obj.id);  
  to_delete.forEach(node &#x3D;&gt; this.removeFromViewContainer(node.ref));

 
 // if(to_delete.length &gt; 0) console.log(&quot;Error: Removing Connection triggered other deletions&quot;);

   this.processConnectionEnd();
  
   if(this.tree.getType(to)&#x3D;&#x3D;&#x3D;&quot;op&quot;){
     this.performAndUpdateDownstream(to);
   }
  
  this.addTimelineState();


}

 

 selectionStarted(){

  this.selection.start &#x3D; this.last;
  this.selection.active &#x3D; true;
 }

 panStarted(mouse_pos: Point){
  console.log(&quot;PAN STARTED&quot;)
  this.last_point &#x3D; mouse_pos;
  this.freezePaletteObjects();

 }

 /**
 * brings the base canvas to view and begins to render the
 * @param mouse the absolute position of the mouse on screen
 */
shapeStarted(mouse: Point){

  const rel:Point &#x3D; {
    x: mouse.x - this.viewport.getTopLeft().x,
    y: mouse.y - this.viewport.getTopLeft().y
  }
  
  this.shape_bounds &#x3D; {
    topleft: rel,
    width: this.zs.zoom,
    height: this.zs.zoom
  };


  this.shape_vtxs &#x3D; [];
  this.canvas_zndx &#x3D; this.layers.createLayer(); //bring this canvas forward
  this.cx.fillStyle &#x3D; &quot;#ff4081&quot;;
  this.cx.fillRect( this.shape_bounds.topleft.x, this.shape_bounds.topleft.y, this.shape_bounds.width,this.shape_bounds.height);
  
  if(this.dm.isSelected(&#x27;free&#x27;, &#x27;shapes&#x27;)){
    this.startSnackBar(&quot;CTRL+Click to end drawing&quot;, this.shape_bounds);
  }else{
    this.startSnackBar(&quot;Press SHIFT while dragging to constrain shape&quot;, this.shape_bounds);
  }
 

}

  /**
   * resizes and redraws the shape between the the current mouse and where the shape started
   * @param mouse the absolute position of the mouse on screen
   */
shapeDragged(mouse: Point, shift: boolean){

  const rel:Point &#x3D; {
    x: mouse.x - this.viewport.getTopLeft().x,
    y: mouse.y - this.viewport.getTopLeft().y
  }

  this.shape_bounds.width &#x3D;  (rel.x - this.shape_bounds.topleft.x);
  this.shape_bounds.height &#x3D;  (rel.y - this.shape_bounds.topleft.y);

  if(shift){
    const max: number &#x3D; Math.max(this.shape_bounds.width, this.shape_bounds.height);
    
    //allow lines to snap to coords
    if(this.dm.isSelected(&#x27;line&#x27;, &#x27;shapes&#x27;)){
        if(Math.abs(this.shape_bounds.width) &lt; Math.abs(this.shape_bounds.height/2)){
          this.shape_bounds.height &#x3D; max;
          this.shape_bounds.width &#x3D; this.zs.zoom;
        }else if(Math.abs(this.shape_bounds.height) &lt; Math.abs(this.shape_bounds.width/2)){
          this.shape_bounds.width &#x3D; max;
          this.shape_bounds.height &#x3D; this.zs.zoom;
        }else{
          this.shape_bounds.width &#x3D; max;
          this.shape_bounds.height &#x3D; max;  
        }
        
    }else{
      this.shape_bounds.width &#x3D; max;
      this.shape_bounds.height &#x3D; max;    
  
    }
  }

  this.cx.clearRect(0, 0, this.canvas.width, this.canvas.height);
  this.cx.beginPath();
  this.cx.fillStyle &#x3D; &quot;#ff4081&quot;;
  this.cx.strokeStyle &#x3D; &quot;#ff4081&quot;;
  this.cx.setLineDash([]);
  this.cx.lineWidth &#x3D; this.zs.zoom;

  if(this.dm.isSelected(&#x27;line&#x27;, &#x27;shapes&#x27;)){
    this.cx.moveTo(this.shape_bounds.topleft.x+this.zs.zoom, this.shape_bounds.topleft.y+this.zs.zoom);
    this.cx.lineTo(this.shape_bounds.topleft.x + this.shape_bounds.width, this.shape_bounds.topleft.y + this.shape_bounds.height);
    this.cx.stroke();
  }else if(this.dm.isSelected(&#x27;fill_circle&#x27;,&#x27;shapes&#x27;)){
    this.shape_bounds.width &#x3D; Math.abs(this.shape_bounds.width);
    this.shape_bounds.height &#x3D; Math.abs(this.shape_bounds.height);
    this.cx.ellipse(this.shape_bounds.topleft.x, this.shape_bounds.topleft.y, this.shape_bounds.width, this.shape_bounds.height, 2 * Math.PI, 0,  this.shape_bounds.height/2);
    this.cx.fill();
  }else if(this.dm.isSelected(&#x27;stroke_circle&#x27;,&#x27;shapes&#x27;)){
    this.cx.ellipse(this.shape_bounds.topleft.x, this.shape_bounds.topleft.y, this.shape_bounds.width, this.shape_bounds.height, 2 * Math.PI, 0,  this.shape_bounds.height/2);
    this.cx.stroke();
  }else if(this.dm.isSelected(&#x27;fill_rect&#x27;,&#x27;shapes&#x27;)){
    this.cx.fillRect(this.shape_bounds.topleft.x, this.shape_bounds.topleft.y,this.shape_bounds.width,this.shape_bounds.height);
  
  }else if(this.dm.isSelected(&#x27;stroke_rect&#x27;,&#x27;shapes&#x27;)){
    this.cx.strokeRect(this.shape_bounds.topleft.x + this.zs.zoom, this.shape_bounds.topleft.y+ this.zs.zoom,this.shape_bounds.width-this.zs.zoom,this.shape_bounds.height-this.zs.zoom);

  }else{

    if(this.shape_vtxs.length &gt; 1){
      this.cx.moveTo(this.shape_vtxs[0].x, this.shape_vtxs[0].y);

      for(let i &#x3D; 1; i &lt; this.shape_vtxs.length; i++){
        this.cx.lineTo(this.shape_vtxs[i].x, this.shape_vtxs[i].y);
        //this.cx.moveTo(this.shape_vtxs[i].x, this.shape_vtxs[i].y);
      }

    }else{
      this.cx.moveTo(this.shape_bounds.topleft.x, this.shape_bounds.topleft.y);
    }

    this.cx.lineTo(this.shape_bounds.topleft.x + this.shape_bounds.width, this.shape_bounds.topleft.y + this.shape_bounds.height);
    this.cx.stroke();
    this.cx.fill();
    
  }

  if(this.dm.isSelected(&#x27;free&#x27;, &#x27;shapes&#x27;)){
    this.updateSnackBar(&quot;CTRL+click to end drawing&quot;, this.shape_bounds);
  }else{
    this.updateSnackBar(&quot;Press SHIFT to contstrain shape&quot;, this.shape_bounds);
  }
}


/**
 * clears the scratchpad for the new drawing event
 */
drawStarted(){


  this.canvas_zndx &#x3D; this.layers.createLayer(); //bring this canvas forward
  
  this.scratch_pad &#x3D; [];
  for(let i &#x3D; 0; i &lt; this.canvas.height; i+&#x3D;this.zs.zoom ){
      const row &#x3D; [];
      for(let j &#x3D; 0; j&lt; this.canvas.width; j+&#x3D;this.zs.zoom ){
          row.push(createCell(null));
      }
    this.scratch_pad.push(row);
    }

    this.startSnackBar(&quot;Drag to Draw&quot;, null);
  }


  /**
   * gets the bounds of a drawing on the scratchpad, a drawing is represented by set cells
   * @returns an object representing the bounds in the format of i, j (the row, column index of the pad)
   */
  getScratchPadBounds(): Array&lt;Interlacement&gt;{
    let bottom: number &#x3D; 0;
    let right: number &#x3D; 0;
    let top: number &#x3D; this.scratch_pad.length-1;
    let left: number &#x3D; this.scratch_pad[0].length-1;

    for(let i &#x3D; 0; i &lt; this.scratch_pad.length; i++ ){
      for(let j &#x3D; 0; j&lt;  this.scratch_pad[0].length; j++){
        if((this.scratch_pad[i][j].is_set)){
          if(i &lt; top) top &#x3D; i;
          if(j &lt; left) left &#x3D; j;
          if(i &gt; bottom) bottom &#x3D; i;
          if(j &gt; right) right &#x3D; j;
        } 
      }
    }

    return [{i: top, j: left, si: -1}, {i: bottom, j: right, si: -1}];

  }

  /**
   * handles checks and actions to take when drawing event ends
   * gets the boudary of drawn segment and creates a subdraft containing that drawing
   * if the drawing sits on top of an existing subdraft, merge the drawing into that subdraft (extending the original if neccessary)
   * @returns 
   */
  processDrawingEnd (): Promise&lt;any&gt; {


    this.canvas_zndx &#x3D; -1;

    if(this.scratch_pad &#x3D;&#x3D;&#x3D; undefined) return;
    if(this.scratch_pad[0] &#x3D;&#x3D;&#x3D; undefined) return;
    
    const corners: Array&lt;Interlacement&gt; &#x3D; this.getScratchPadBounds();
    const warps &#x3D; corners[1].j - corners[0].j + 1;
    const wefts &#x3D; corners[1].i - corners[0].i + 1;


    //there must be at least one cell selected
    if(warps &lt; 1 || wefts &lt; 1){
      this.scratch_pad &#x3D; undefined;
      return;
    } 


    const pattern: Array&lt;Array&lt;Cell&gt;&gt; &#x3D; [];
    for(let i &#x3D; 0; i &lt; wefts; i++ ){
      pattern.push([]);
      for(let j &#x3D; 0; j&lt; warps; j++){
        const c &#x3D; this.scratch_pad[corners[0].i+i][corners[0].j+j];
        const b &#x3D; this.getScratchpadProduct({i:i, j:j, si:-1}, this.inks.getSelected(),c);
        pattern[i].push(createCell(b));
      }
    }

    //if this drawing does not intersect with any existing subdrafts, 
    return this.createSubDraft(initDraftWithParams({wefts: wefts,  warps: warps, pattern: pattern}), -1)
    .then(sd &#x3D;&gt; {
      const pos &#x3D; {
        topleft: {x: this.viewport.getTopLeft().x + (corners[0].j * this.zs.zoom), y: this.viewport.getTopLeft().y + (corners[0].i * this.zs.zoom)},
        width: warps * this.zs.zoom,
        height: wefts * this.zs.zoom
      }
  
      sd.setPosition(pos.topleft);
      //sd.setComponentSize(pos.width, pos.height);
      sd.disableDrag();

  
    //  const had_merge &#x3D; this.mergeSubdrafts(sd);
      this.addTimelineState();
    });
   

  }

  /**
   * update the viewport when the window is resized
   * @param event 
   */
  @HostListener(&#x27;window:resize&#x27;, [&#x27;$event&#x27;])
    onResize(event) {

      this.viewport.setWidth(event.target.innerWidth);
      this.viewport.setHeight(event.target.innerHeight);

      this.canvas.width &#x3D; this.viewport.getWidth();
      this.canvas.height &#x3D; this.viewport.getHeight();
    }


 /**
  * handles actions to take when the mouse is down inside of the palette
  * @param event the mousedown event
  */
  @HostListener(&#x27;mousedown&#x27;, [&#x27;$event&#x27;])
    private onStart(event) {

      if(this.selecting_connection &#x3D;&#x3D; true){
        this.processConnectionEnd();
      }

      if(this.needs_init){
      //this is a hack to update the screen posiitons because not all inforamtion is ready when onload and onview init completes
        let ops &#x3D; this.tree.getOpNodes();
        ops.forEach(op &#x3D;&gt; {
          this.opCompLoaded(op);
  
          let drafts &#x3D; this.tree.getDraftOutputs(op.id);
          drafts.forEach((draft, ndx) &#x3D;&gt; {
            let draftcomp &#x3D; &lt;SubdraftComponent&gt; this.tree.getComponent(draft);
            draftcomp.updatePositionFromParent(&lt;OperationComponent&gt;op.component, ndx)
          })
  
          }
        );
        this.needs_init &#x3D; false;
      }

      const ctrl: boolean &#x3D; event.ctrlKey;
      const mouse:Point &#x3D; {x: this.viewport.getTopLeft().x + event.clientX, y:this.viewport.getTopLeft().y+event.clientY};
      const ndx:any &#x3D; utilInstance.resolveCoordsToNdx(mouse, this.zs.zoom);

      //use this to snap the mouse to the nearest coord
      mouse.x &#x3D; ndx.j * this.zs.zoom;
      mouse.y &#x3D; ndx.i * this.zs.zoom;

      
      this.last &#x3D; ndx;
      this.selection.start &#x3D; this.last;
      this.removeSubscription();    
      
     

      if(this.dm.getDesignMode(&quot;marquee&quot;,&#x27;design_modes&#x27;).selected){
          this.selectionStarted();
          this.moveSubscription &#x3D; 
          fromEvent(event.target, &#x27;mousemove&#x27;).subscribe(e &#x3D;&gt; this.onDrag(e)); 
    
      // }else if(this.dm.isSelected(&quot;draw&quot;,&#x27;design_modes&#x27;)){
      //   this.moveSubscription &#x3D; 
      //   fromEvent(event.target, &#x27;mousemove&#x27;).subscribe(e &#x3D;&gt; this.onDrag(e)); 
  
      //     this.drawStarted();    
      //     this.setCell(ndx);
      //     this.drawCell(ndx); 
      // }else if(this.dm.isSelected(&quot;shape&quot;,&#x27;design_modes&#x27;)){
      //   this.moveSubscription &#x3D; 
      //   fromEvent(event.target, &#x27;mousemove&#x27;).subscribe(e &#x3D;&gt; this.onDrag(e)); 
  

      //   if(this.dm.isSelected(&#x27;free&#x27;,&#x27;shapes&#x27;)){
      //     if(ctrl){
      //       this.processShapeEnd().then(el &#x3D;&gt; {
      //         this.changeDesignmode(&#x27;move&#x27;);
      //         this.cx.clearRect(0, 0, this.canvas.width, this.canvas.height);
      //       });
      //     }else{
      //       if(this.shape_vtxs.length &#x3D;&#x3D; 0) this.shapeStarted(mouse);
      //       this.shape_vtxs.push(mouse);
      //     }
            
          
      //   }else{
      //     this.shapeStarted(mouse);
      //   }
      // }else if(this.dm.isSelected(&quot;operation&quot;,&#x27;design_modes&#x27;)){
        // this.processConnectionEnd();
        // this.changeDesignmode(&#x27;move&#x27;);
      }else if(this.dm.isSelected(&quot;move&quot;, &quot;design_modes&quot;)){

       if(event.shiftKey) return;
        this.multiselect.clearSelections();

      }else if(this.dm.isSelected(&quot;pan&quot;, &#x27;design_modes&#x27;)){

        this.panStarted({x: event.clientX, y: event.clientY});
        this.moveSubscription &#x3D; 
        fromEvent(event.target, &#x27;mousemove&#x27;).subscribe(e &#x3D;&gt; this.onDrag(e)); 

      }
  }


  @HostListener(&#x27;mousemove&#x27;, [&#x27;$event&#x27;])
  private onMove(event) {





    const shift: boolean &#x3D; event.shiftKey;
    const mouse:Point &#x3D; {x: this.viewport.getTopLeft().x + event.clientX, y:this.viewport.getTopLeft().y+event.clientY};
    const ndx:any &#x3D; utilInstance.resolveCoordsToNdx(mouse, this.zs.zoom);
    mouse.x &#x3D; ndx.j * this.zs.zoom;
    mouse.y &#x3D; ndx.i *this.zs.zoom;

    if(this.dm.isSelected(&#x27;free&#x27;,&#x27;shapes&#x27;) &amp;&amp; this.shape_vtxs.length &gt; 0){
     this.shapeDragged(mouse, shift);
    }else if(this.selecting_connection){
      this.connectionDragged(mouse, shift);
    }
  }
  
 /**
  * called when the operation input is selected and used to draw
   * @param event the event object
   */
  mouseSelectingDraft(event: any, id: number){

    const shift: boolean &#x3D; event.shiftKey;
    const mouse: Point &#x3D; {x: this.viewport.getTopLeft().x + event.clientX, y:this.viewport.getTopLeft().y+event.clientY};
    const ndx:Interlacement &#x3D; utilInstance.resolveCoordsToNdx(mouse, this.zs.zoom);
    //use this to snap the mouse to the nearest coord
    mouse.x &#x3D; ndx.j * this.zs.zoom;
    mouse.y &#x3D; ndx.i * this.zs.zoom;

    if(utilInstance.isSameNdx(this.last, ndx)) return;

    // if(this.dm.getDesignMode(&quot;operation&quot;,&#x27;design_modes&#x27;).selected){

     
    
    // }
    
    this.last &#x3D; ndx;
  }

  /**
   * called form the subscription created on start, checks the index of the location and returns null if its the same
   * @param event the event object
   */
  onDrag(event){


    const shift: boolean &#x3D; event.shiftKey;
    const mouse: Point &#x3D; {x: this.viewport.getTopLeft().x + event.clientX, y:this.viewport.getTopLeft().y+event.clientY};
    const ndx:Interlacement &#x3D; utilInstance.resolveCoordsToNdx(mouse, this.zs.zoom);

    //use this to snap the mouse to the nearest coord
    mouse.x &#x3D; ndx.j *this.zs.zoom;
    mouse.y &#x3D; ndx.i * this.zs.zoom;

    if(utilInstance.isSameNdx(this.last, ndx)) return;

    if(this.dm.getDesignMode(&quot;marquee&quot;,&#x27;design_modes&#x27;).selected){

     this.drawSelection(ndx);
     const bounds:Bounds &#x3D; this.getSelectionBounds(this.selection.start,  this.last);    
     this.selection.setPositionAndSize(bounds);
    }else if(this.dm.getDesignMode(&quot;pan&quot;,&#x27;design_modes&#x27;).selected){
      
      const diff &#x3D; {
        x:  (this.last_point.x-event.clientX), 
        y: (this.last_point.y-event.clientY)}

      this.handlePan(diff);

    }
    
    // }else if(this.dm.getDesignMode(&quot;draw&quot;, &#x27;design_modes&#x27;).selected){
    //   this.setCell(ndx);
    //   this.drawCell(ndx);
    // }else if(this.dm.getDesignMode(&quot;shape&quot;,&#x27;design_modes&#x27;).selected){
    //   this.shapeDragged(mouse, shift);
    // }
    
    this.last &#x3D; ndx;
    this.last_point &#x3D; {x: event.clientX, y: event.clientY};
  }

  

/**
 * Called when the mouse is up or leaves the boundary of the view
 * @param event 
 * @returns 
 */
  @HostListener(&#x27;mouseleave&#x27;, [&#x27;$event&#x27;])
  @HostListener(&#x27;mouseup&#x27;, [&#x27;$event&#x27;])
     private onEnd(event) {

      //if this.last is null, we have a mouseleave with no mousestart
      if(this.last &#x3D;&#x3D;&#x3D; undefined) return;
    
      const mouse: Point &#x3D; {x: this.viewport.getTopLeft().x + event.clientX, y:this.viewport.getTopLeft().y+event.clientY};
      const ndx:Interlacement &#x3D; utilInstance.resolveCoordsToNdx(mouse, this.zs.zoom);
      //use this to snap the mouse to the nearest coord
      mouse.x &#x3D; ndx.j * this.zs.zoom;
      mouse.y &#x3D; ndx.i * this.zs.zoom;

      this.removeSubscription();   

      if(this.dm.getDesignMode(&quot;marquee&quot;,&#x27;design_modes&#x27;).selected){
        if(this.selection.active) this.processSelection();
        this.closeSnackBar();
        this.cx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.changeDesignmode(&#x27;move&#x27;);
        this.unfreezePaletteObjects();
      }else if(this.dm.isSelected(&#x27;pan&#x27;, &#x27;design_modes&#x27;)){
        const div:HTMLElement &#x3D; document.getElementById(&#x27;scrollable-container&#x27;);
        this.viewport.set(div.offsetParent.scrollLeft, div.offsetParent.scrollTop,  div.offsetParent.clientWidth,  div.offsetParent.clientHeight);

      }


      // }else if(this.dm.isSelected(&quot;draw&quot;,&#x27;design_modes&#x27;)){
       
      //   this.processDrawingEnd().then(el &#x3D;&gt; {
      //     this.closeSnackBar();
      //     this.cx.clearRect(0, 0, this.canvas.width, this.canvas.height);
      //     this.changeDesignmode(&#x27;move&#x27;);
      //     this.scratch_pad &#x3D; undefined;
      //   }).catch(console.error);
      



      // }else if(this.dm.isSelected(&quot;shape&quot;,&#x27;design_modes&#x27;)){
      //   if(!this.dm.isSelected(&#x27;free&#x27;,&#x27;shapes&#x27;)){
          
      //     this.processShapeEnd().then(el &#x3D;&gt; {
      //       this.cx.clearRect(0, 0, this.canvas.width, this.canvas.height);
      //       this.changeDesignmode(&#x27;move&#x27;);
           
      //    });
      //   }
          
      // }

      //unset vars that would have been created on press
      this.last &#x3D; undefined;
      this.last_point &#x3D; undefined;
      this.selection.active &#x3D; false;
      this.canvas_zndx &#x3D; -1; 
  }
  
 
  /**
   * Called when a selection operation ends. Checks to see if this selection intersects with any subdrafts and 
   * merges and or splits as required. 
   */
  processSelection(){

    this.closeSnackBar();

    //create the selection as subdraft
    const bounds:Bounds &#x3D; this.getSelectionBounds(this.selection.start,  this.last);    
    
    
    this.createSubDraft(initDraftWithParams({wefts: bounds.height/this.zs.zoom, warps: bounds.width/this.zs.zoom}), -1)
    .then(sc &#x3D;&gt; {
      sc.setPosition(bounds.topleft);
      //const isect:Array&lt;SubdraftComponent&gt; &#x3D; this.getIntersectingSubdrafts(sc);
      const isect &#x3D; [];
      if(isect.length &#x3D;&#x3D;&#x3D; 0){
        this.addTimelineState();
        return;
      } 

       //get a draft that reflects only the poitns in the selection view
      // const new_draft: Draft &#x3D; this.getCombinedDraft(bounds, sc, isect);
      // this.tree.setDraftOnly(sc.id, new_draft)
    

    // isect.forEach(el &#x3D;&gt; {
    //   const ibound &#x3D; utilInstance.getIntersectionBounds(sc, el);

    //   if(el.isSameBoundsAs(ibound)){
    //      console.log(&quot;Component had same Bounds as Intersection, Consumed&quot;);
    //      this.removeSubdraft(el.id);
    //   }

    // });
    })
    .catch(console.error);
   
    
    
   

  }


  /**
   * this function will update any components that should move when the compoment passed by obj moves
   * moves all compoments returned from tree.getNodesToUpdate(). All changes to what updates should be 
   * handled by getNodesToUpdateOnMove
   * @param obj 
   */
  updateAttachedComponents(id: number, follow: boolean){

    //start by moving the original object than ripple out;
    const moving : any &#x3D; this.tree.getComponent(id);

    this.tree.getInputs(id).forEach(cxn &#x3D;&gt; {
       const comp: ConnectionComponent &#x3D; &lt;ConnectionComponent&gt;this.tree.getComponent(cxn);
       comp.updateToPosition(id, this.zs.zoom);
    });

    this.tree.getOutputs(id).forEach(cxn &#x3D;&gt; {
      const comp: ConnectionComponent &#x3D; &lt;ConnectionComponent&gt;this.tree.getComponent(cxn);
      comp.updateFromPosition(id, this.zs.zoom);
   });

   if(!follow) return;

   const outs: Array&lt;number&gt; &#x3D; this.tree.getNonCxnOutputs(id);

   //if this an operation with one child, move the child. 
   if(this.tree.getType(moving.id) &#x3D;&#x3D;&#x3D; &quot;op&quot; ){

      outs.forEach((out, ndx) &#x3D;&gt; {
        const out_comp &#x3D; &lt;SubdraftComponent&gt; this.tree.getComponent(out);
        if(this.tree.getType(out_comp.id) &#x3D;&#x3D;&#x3D; &#x27;draft&#x27;) out_comp.updatePositionFromParent(moving, ndx);
        this.updateAttachedComponents(out_comp.id, false);
      })

    
    }

    const ins &#x3D; this.tree.getNonCxnInputs(id);
    //if this is a draft with a parent, move the parent as well 
    if(this.tree.getType(moving.id) &#x3D;&#x3D;&#x3D; &quot;draft&quot; &amp;&amp; !this.tree.isSibling(moving.id)){
      ins.forEach(input &#x3D;&gt; {
        const in_comp: OperationComponent &#x3D; &lt;OperationComponent&gt; this.tree.getComponent(input);
        in_comp.updatePositionFromChild(moving);
        this.updateAttachedComponents(in_comp.id, false);
      });
    }
      
   
  }


  /**
   * emitted from a subdraft when an internal action has changeded its value 
   * checks for a child subdraft, recomputes, redraws. 
   * @param obj with attribute id describing the subdraft that called this
   * @returns 
   */
  onSubdraftAction(obj: any){

    if(obj &#x3D;&#x3D;&#x3D; null) return;

    const outputs &#x3D; this.tree.getNonCxnOutputs(obj.id);
    const fns &#x3D; outputs.map(out &#x3D;&gt; this.performAndUpdateDownstream(out));
    Promise.all(fns).then(el &#x3D;&gt; {
      this.addTimelineState();
      this.changeDesignmode(&#x27;move&#x27;)
    })



  }

  /**
   * emitted from an operatioin when its param has changed. This is automatically called on load 
   * which is annoying because it recomputes everything!
   * checks for a child subdraft, recomputes, redraws. 
   * @param obj with attribute id describing the operation that called this
   * @returns 
   */
   async operationParamChanged(obj: any){

    if(obj &#x3D;&#x3D;&#x3D; null) return;

    return this.tree.sweepInlets(obj.id)
      .then(viewRefs &#x3D;&gt; {
        viewRefs.forEach(el &#x3D;&gt; {
          this.removeFromViewContainer(el)
        });
        this.performAndUpdateDownstream(obj.id)
      } )
      .then(el &#x3D;&gt; {
        this.addTimelineState();
      })
      .catch(console.error);
   
    

  }

  paletteClicked(){
  }

/**
 * called from an operation component when it is dragged
 * @param obj (id, point of toplleft)
 */
  operationMoved(obj: any){
    if(obj &#x3D;&#x3D;&#x3D; null) return;
  
    this.updateAttachedComponents(obj.id, true);
    this.moveAllSelections(obj.id);


  }

  /**
 * called from an operation component when it is done moving 
 * this allows us to not write postioin continuously, but just once on end
 * @param obj (id, point of toplleft)
 */
   operationMoveEnded(obj: any){
    if(obj &#x3D;&#x3D;&#x3D; null) return;

    this.updateSelectionPositions(obj.id);

    this.addTimelineState();

  }

  updateSelectionPositions(moving_id: number){
    const selections &#x3D; this.multiselect.getSelections();
    selections.forEach(sel &#x3D;&gt; {
      if(this.tree.getType(sel) !&#x3D; &#x27;cxn&#x27; &amp;&amp; sel !&#x3D;&#x3D; moving_id){
        const comp &#x3D; this.tree.getComponent(sel);
        this.multiselect.setPosition(sel, comp.topleft)
      }

     
    })

  }

  /**
   * this is called when a multi-selected block of items is moved. 
   * Sometimes its called if you paste one set of items to a new space, in which case the nodes do
   * not yet exist. 
   * @param moving_id 
   * @returns 
   */
  moveAllSelections(moving_id: number){
    const selections &#x3D; this.multiselect.getSelections();
    if(selections.length &#x3D;&#x3D; 0) return;

    const rel_pos &#x3D; this.multiselect.getRelativePosition();
    const cur_pos &#x3D; this.tree.getComponent(moving_id).topleft;
    const diff:Point &#x3D; {x: cur_pos.x - rel_pos.x, y: cur_pos.y - rel_pos.y};

    selections.forEach(sel &#x3D;&gt; {
      if(this.tree.getNode(sel) &#x3D;&#x3D; null) return;

      if(this.tree.getType(sel) &#x3D;&#x3D; &#x27;op&#x27; &amp;&amp; sel !&#x3D;&#x3D; moving_id){
        const comp &#x3D; this.tree.getComponent(sel);
        comp.topleft &#x3D; this.multiselect.getNewPosition(sel, diff);
        this.updateAttachedComponents(sel, true);
      }
      if(this.tree.getType(sel)&#x3D;&#x3D;&#x27;draft&#x27; &amp;&amp; sel !&#x3D;&#x3D; moving_id){
        const comp &#x3D; &lt;SubdraftComponent&gt; this.tree.getComponent(sel);
        if(comp.parent_id &#x3D;&#x3D; -1) comp.setPosition( this.multiselect.getNewPosition(sel, diff));
      }
    });
  }




  /**
   * called when subdraft component says its moving
   * @param obj the subdraft that called this
   * @returns 
   */
  subdraftMoved(obj: any){


      if(obj &#x3D;&#x3D;&#x3D; null) return;
  
      //get the reference to the draft that&#x27;s moving
      const moving &#x3D; &lt;SubdraftComponent&gt; this.tree.getComponent(obj.id);
      
      if(moving &#x3D;&#x3D;&#x3D; null) return; 

      this.moveAllSelections(obj.id);
  
    


      // // this.updateSnackBar(&quot;Using Ink: &quot;+moving.ink,null);
       this.updateAttachedComponents(moving.id, true);


      // const isect:Array&lt;SubdraftComponent&gt; &#x3D; this.getIntersectingSubdrafts(moving);
      // const seed_drafts &#x3D; isect.filter(el &#x3D;&gt; !this.tree.hasParent(el.id)); //filter out drafts that were generated

      // if(seed_drafts.length &#x3D;&#x3D;&#x3D; 0){
      //   if(this.tree.hasPreview()) this.removePreview();
      //   return;
      // } 

      // const bounds: Bounds &#x3D; utilInstance.getCombinedBounds(moving, seed_drafts);
      // const temp: Draft &#x3D; this.getCombinedDraft(bounds, moving, seed_drafts);
      


      // if(this.tree.hasPreview()) {
       
      //   this.tree.setPreviewDraft(temp).then(dn &#x3D;&gt; {
      //     dn.component.bounds &#x3D; bounds;
      //    (&lt;SubdraftComponent&gt; dn.component).setPosition(bounds.topleft)
      //   });
      // }else{
      //   this.createAndSetPreview(temp).then(dn &#x3D;&gt; {
      //     dn.component.bounds &#x3D; bounds;
      //     (&lt;SubdraftComponent&gt; dn.component).setPosition(bounds.topleft)
      //   }).catch(console.error);
      // } 
    
    }


   /**
    * checks if this subdraft has been dropped onto of another and merges them accordingly 
    * @param obj 
    * @returns 
    */
  subdraftDropped(obj: any){

    this.closeSnackBar();

     if(obj &#x3D;&#x3D;&#x3D; null) return;
     this.updateSelectionPositions(obj.id);

  
      //creaet a subdraft of this intersection
      if(this.tree.hasPreview()){

        const preview_node &#x3D; this.tree.getPreview();
        const preview_draft &#x3D; preview_node.draft;
        let to_right &#x3D; (&lt;SubdraftComponent&gt; preview_node.component).getTopleft();

        this.createSubDraft(initDraftWithParams({wefts: wefts(preview_draft.drawdown), warps: warps(preview_draft.drawdown)}), -1)
        .then(component &#x3D;&gt; {
          this.tree.setDraftPattern(component.id, preview_draft.drawdown);
          //this.redrawDirtyDrafts();
          // to_right.x +&#x3D; preview_node.component.bounds.width + this.zs.zoom *4;
          // component.setPosition(to_right);
          component.zndx &#x3D; this.layers.createLayer();
          this.removePreview();
          const interlacement &#x3D; utilInstance.resolvePointToAbsoluteNdx(component.topleft, this.zs.zoom);
          this.viewport.addObj(component.id, interlacement);
          this.addTimelineState();
          this.tree.unsetPreview();
        })
        .catch(console.error);

      } else{
        this.addTimelineState();
        this.tree.unsetPreview();
      
        //get the reference to the draft that&#x27;s moving
        const moving &#x3D; this.tree.getComponent(obj.id);
        const interlacement &#x3D; utilInstance.resolvePointToAbsoluteNdx(moving.topleft, this.zs.zoom);
        this.viewport.updatePoint(moving.id, interlacement);
      }


  }

  /**
   * merges a collection of subdraft components into the primary component, deletes the merged components
   * @param primary the draft to merge into
   * @returns true or false to describe if a merge took place. 
   */
  // mergeSubdrafts(primary: SubdraftComponent): boolean{

  //   const isect:Array&lt;SubdraftComponent&gt; &#x3D; this.getIntersectingSubdrafts(primary);

  //     if(isect.length &#x3D;&#x3D; 0){
  //       return false;
  //     }   

  //     const bounds: Bounds &#x3D; utilInstance.getCombinedBounds(primary, isect);
  //     const temp: Draft &#x3D; this.getCombinedDraft(bounds, primary, isect);

  //     this.tree.setDraftOnly(primary.id, temp);
  //     primary.setPosition(bounds.topleft);
  //     //primary.drawDraft();
  //     const interlacement &#x3D; utilInstance.resolvePointToAbsoluteNdx(primary.bounds.topleft, this.zs.zoom);

  //     this.viewport.updatePoint(primary.id, interlacement);


  //   //remove the intersecting drafts from the view containier and from subrefts
  //   isect.forEach(element &#x3D;&gt; {
  //     this.removeSubdraft(element.id);
  //   });
  //   return true;
  // }

  computeHeddleValue(p:Point, main: SubdraftComponent, isect: Array&lt;SubdraftComponent&gt;):boolean{
    const a:boolean &#x3D; main.resolveToValue(p);
    //this may return an empty array, because the intersection might not have the point
    const b_array:Array&lt;SubdraftComponent&gt; &#x3D; isect.filter(el &#x3D;&gt; el.hasPoint(p));

    //should never have more than one value in barray
    // if(b_array.length &gt; 1) console.log(&quot;WARNING: Intersecting with Two Elements&quot;);

    const val:boolean &#x3D; b_array.reduce((acc:boolean, arr) &#x3D;&gt; arr.resolveToValue(p), null);   
    
    return utilInstance.computeFilter(main.ink, a, val);
  }



  // getSubdraftsIntersectingSelection(selection: MarqueeComponent){

  //   //find intersections between main and the others
  //   const drafts: Array&lt;SubdraftComponent&gt; &#x3D; this.tree.getDrafts();
  //   const isect:Array&lt;SubdraftComponent&gt; &#x3D; drafts.filter(sr &#x3D;&gt; (utilInstance.doOverlap(
  //     selection.bounds.topleft, 
  //     {x:  selection.bounds.topleft.x + selection.bounds.width, y: selection.bounds.topleft.y + selection.bounds.height}, 
  //     sr.getTopleft(), 
  //     {x: sr.getTopleft().x + sr.bounds.width, y: sr.getTopleft().y + sr.bounds.height}
  //     ) ? sr : null));

  //   return isect;
  
  // }


 /**
   * get any subdrafts that intersect a given screen position
   * @param p the x, y position of this cell 
   * @returns 
   */
  // getIntersectingSubdraftsForPoint(p: any){

  //   const primary_topleft &#x3D; {x:  p.x, y: p.y };
  //   const primary_bottomright &#x3D; {x:  p.x + this.zs.zoom, y: p.y + this.zs.zoom};

  //   const isect:Array&lt;SubdraftComponent&gt; &#x3D; [];
  //   const drafts: Array&lt;SubdraftComponent&gt; &#x3D; this.tree.getDrafts();
  //   drafts.forEach(sr &#x3D;&gt; {
  //     let sr_bottomright &#x3D; {x: sr.getTopleft().x + sr.bounds.width, y: sr.getTopleft().y + sr.bounds.height};
  //     const b: boolean &#x3D; utilInstance.doOverlap(primary_topleft, primary_bottomright, sr.getTopleft(), sr_bottomright);
  //     if(b) isect.push(sr);
  //    });

  //   return isect;
  // }

  /**
   * get any subdrafts that intersect primary based on checks on their boundaries
   * @param primary 
   * @returns 
   */
  // getIntersectingSubdrafts(primary: SubdraftComponent){

  //   const primary_draft &#x3D; this.tree.getDraft(primary.id);
  //   const drafts:Array&lt;DraftNode&gt; &#x3D;  this.tree.getDraftNodes(); 
  //   const to_check:Array&lt;DraftNode&gt; &#x3D;  drafts.filter(sr &#x3D;&gt; (sr.draft.id.toString() !&#x3D;&#x3D; primary_draft.id.toString()));
  //   const primary_bottomright &#x3D; {x:  primary.getTopleft().x + primary.bounds.width, y: primary.getTopleft().y + primary.bounds.height};


  //    const isect:Array&lt;SubdraftComponent&gt; &#x3D; [];
  //    to_check
  //    .map(el &#x3D;&gt; &lt;SubdraftComponent&gt; this.tree.getComponent(el.id))
  //    .forEach(sr &#x3D;&gt; {
  //     let sr_bottomright &#x3D; {x: sr.getTopleft().x + sr.bounds.width, y: sr.getTopleft().y + sr.bounds.height};
  //     const b: boolean &#x3D; utilInstance.doOverlap(primary.getTopleft(), primary_bottomright, sr.getTopleft(), sr_bottomright);
  //     if(b) isect.push(sr);
  //    });

  //   return isect;
  // }

  getSelectionBounds(c1: any, c2: any): Bounds{
      let bottomright &#x3D; {x: 0, y:0};
      let bounds:Bounds &#x3D; {
        topleft:{x: 0, y:0},
        width: 0,
        height: 0
      }
      if(c1.i &lt; c2.i){
        bounds.topleft.y &#x3D; c1.i * this.zs.zoom;
        bottomright.y &#x3D; c2.i * this.zs.zoom;
      }else{
        bounds.topleft.y &#x3D; c2.i * this.zs.zoom;
        bottomright.y &#x3D; c1.i * this.zs.zoom;
      }

      if(c1.j &lt; c2.j){
        bounds.topleft.x &#x3D; c1.j * this.zs.zoom;
        bottomright.x &#x3D; c2.j * this.zs.zoom;
      }else{
        bounds.topleft.x &#x3D; c1.j * this.zs.zoom;
        bottomright.x &#x3D; c2.j * this.zs.zoom;
      }

      bounds.width &#x3D; bottomright.x - bounds.topleft.x;
      bounds.height &#x3D; bottomright.y - bounds.topleft.y;

      return bounds;
  }

      /**
     * creates a draft in size bounds that contains all of the computed points of its intersections
     * @param bounds the boundary of all the intersections
     * @param primary the primary draft that we are checking for intersections
     * @param isect an Array of the intersecting components
     * @returns 
     */
       getCombinedDraft(bounds: Bounds, primary: SubdraftComponent, isect: Array&lt;SubdraftComponent&gt;):Draft{
  
        const primary_draft &#x3D; this.tree.getDraft(primary.id);

        const temp: Draft &#x3D; initDraftWithParams({
          id: primary_draft.id, 
          gen_name: getDraftName(primary_draft), 
          warps: Math.floor(bounds.width / this.zs.zoom), 
          wefts: Math.floor(bounds.height / this.zs.zoom)});
    
        for(var i &#x3D; 0; i &lt; wefts(temp.drawdown); i++){
          const top: number &#x3D; bounds.topleft.y + (i * this.zs.zoom);
          for(var j &#x3D; 0; j &lt; warps(temp.drawdown); j++){
            const left: number &#x3D; bounds.topleft.x + (j * this.zs.zoom);
    
            const p &#x3D; {x: left, y: top};
            const val &#x3D; this.computeHeddleValue(p, primary, isect);
            if(val !&#x3D; null) temp.drawdown[i][j] &#x3D; setCellValue(temp.drawdown[i][j], val);
            else setCellValue(temp.drawdown[i][j], null);
          }
        }
        return temp;
      }



      /**
       * TODO: Update this to get bounds and print all items, not just what&#x27;s visible
       * @param obj 
       * @returns 
       */
  getPrintableCanvas(obj): HTMLCanvasElement{

    this.cx.clearRect(0, 0, this.canvas.width, this.canvas.height);
    const drafts: Array&lt;SubdraftComponent&gt; &#x3D; this.tree.getDrafts();
    drafts.forEach(sd &#x3D;&gt; {
      sd.drawForPrint(this.canvas, this.cx, this.zs.zoom);
    });

    const ops: Array&lt;OperationComponent&gt; &#x3D; this.tree.getOperations();
    ops.forEach(op &#x3D;&gt; {
      op.drawForPrint(this.canvas, this.cx, this.zs.zoom);
    });

    const cxns: Array&lt;ConnectionComponent&gt; &#x3D; this.tree.getConnections();
    cxns.forEach(cxn &#x3D;&gt; {
      cxn.drawForPrint(this.canvas, this.cx, this.zs.zoom);
    });

    // this.note_components.forEach(note &#x3D;&gt;{
    //   note.drawForPrint(this.canvas, this.cx, this.scale);
    // })

    return this.canvas;

  }

  clearCanvas(){
    this.cx.clearRect(0, 0, this.canvas.width, this.canvas.height);
  }

  // redrawOpenModals(){
  //   const comps &#x3D; this.tree.getDrafts();
  //   comps.forEach(sd &#x3D;&gt; {
  //     if(sd.modal !&#x3D;&#x3D; undefined &amp;&amp; sd.modal.componentInstance !&#x3D;&#x3D; null){
  //       sd.modal.componentInstance.redraw();
  //     }
  //   })
  // }
    
  redrawAllSubdrafts(){
      const comps &#x3D; this.tree.getDrafts();
      comps.forEach(sd &#x3D;&gt; {
        sd.redrawExistingDraft();
      })
    }
  }</code></pre>
        </div>
    </div>










                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
           </div>
       </div>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/search/search.js"></script>
       <script src="../js/search/lunr.min.js"></script>
       <script src="../js/search/search-lunr.js"></script>

       <script src="../js/menu.js"></script>
       <script src="../js/libs/highlight.pack.js"></script>
       <script src="../js/libs/highlightjs-line-numbers.min.js"></script>
       <script src="../js/search/search_index.js"></script>
       <script>
            document.addEventListener('DOMContentLoaded', function() {
                hljs.initHighlightingOnLoad();
                hljs.initLineNumbersOnLoad();
            });
       </script>

    </body>
</html>
