<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>adacad-weaver documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">adacad-weaver documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>Interlacement</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/weaver/palette/subdraft/subdraft.component.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#i">i</a>
                                </li>
                                <li>
                                        <a href="#j">j</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="i"></a>
                                        <span class="name"><b>i</b><a href="#i"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>i:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="j"></a>
                                        <span class="name"><b>j</b><a href="#j"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>j:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnInit, Input, Output, EventEmitter, ElementRef} from &#x27;@angular/core&#x27;;
import { Draft } from &#x27;../../../core/model/draft&#x27;;
import { ConnectionComponent } from &#x27;../connection/connection.component&#x27;;


interface Point {
  x: number;
  y: number;
}

interface Interlacement {
  i:number;
  j:number;
}

interface DesignActions{
  value: string;
  viewValue: string;
  icon: string;
}

@Component({
  selector: &#x27;app-subdraft&#x27;,
  templateUrl: &#x27;./subdraft.component.html&#x27;,
  styleUrls: [&#x27;./subdraft.component.scss&#x27;]
})



export class SubdraftComponent implements OnInit {

  @Input()  draft: Draft;
  @Input()  patterns: any;
  @Input()  parent: ConnectionComponent;
  @Input()  children: Array&lt;ConnectionComponent&gt;;
  @Output() onSubdraftMove &#x3D; new EventEmitter &lt;any&gt;(); 
  @Output() onSubdraftDrop &#x3D; new EventEmitter &lt;any&gt;(); 
  @Output() onSubdraftStart &#x3D; new EventEmitter &lt;any&gt;(); 

 //operations you can perform on a selection 
 design_actions: DesignActions[] &#x3D; [
  {value: &#x27;toggle&#x27;, viewValue: &#x27;Invert Region&#x27;, icon: &quot;fas fa-adjust&quot;},
  {value: &#x27;flip_x&#x27;, viewValue: &#x27;Vertical Flip&#x27;, icon: &quot;fas fa-arrows-alt-v&quot;},
  {value: &#x27;flip_y&#x27;, viewValue: &#x27;Horizontal Flip&#x27;, icon: &quot;fas fa-arrows-alt-h&quot;},
  {value: &#x27;shift_left&#x27;, viewValue: &#x27;Shift 1 Warp Left&#x27;, icon: &quot;fas fa-arrow-left&quot;},
  {value: &#x27;shift_up&#x27;, viewValue: &#x27;Shift 1 Pic Up&#x27;, icon: &quot;fas fa-arrow-up&quot;},
  {value: &#x27;copy&#x27;, viewValue: &#x27;Copy Selected Region&#x27;, icon: &quot;fa fa-clone&quot;},
  {value: &#x27;paste&#x27;, viewValue: &#x27;Paste Copyed Pattern to Selected Region&#x27;, icon: &quot;fa fa-paste&quot;},
  {value: &#x27;delete&#x27;, viewValue: &#x27;Delete this Draft&#x27;, icon: &quot;fa fa-trash&quot;}
];


  canvas: HTMLCanvasElement;
  cx: any;

  topleft &#x3D; {x: 0, y: 0}; //this is an internal reprsentation of the top left point
  
  size &#x3D; {w: 0, h: 0};

  scale &#x3D; 10; 
  filter &#x3D; &#x27;or&#x27;; //can be or, and, neq, not, splice
  counter:number  &#x3D;  0; // only call functions every so often
  
  moving &#x3D; false;
  draw_mode &#x3D; false;
  disable_drag &#x3D; false;


  constructor(private el: ElementRef) { 
        //add random position for testing
        this.topleft.x &#x3D; Math.floor(Math.random() * 400 / this.scale)  * this.scale;
        this.topleft.y &#x3D; Math.floor(Math.random() * 400 / this.scale)  * this.scale;
        
  }

  ngOnInit(){
    this.size.w &#x3D; this.draft.warps * this.scale;
    this.size.h &#x3D; this.draft.wefts * this.scale;

  }


  ngAfterViewInit() {

    this.canvas &#x3D; &lt;HTMLCanvasElement&gt; document.getElementById(this.draft.id.toString());
    this.cx &#x3D; this.canvas.getContext(&quot;2d&quot;);
    this.drawDraft(this.draft);

    console.log(&quot;after init&quot;);

  }

  public setPositionAndSize(bounds: any){
    console.log(&quot;setting to&quot;, bounds);
    this.topleft &#x3D; bounds.topleft;
    this.size.w &#x3D; bounds.width;
    this.size.h &#x3D; bounds.height;
    console.log(this.size.h);
  }




  public filterActionChange(event: any){
    console.log(event);
    this.filter &#x3D; event;

  }

  public computeFilter(a: boolean, b: boolean):boolean{

    if(a &#x3D;&#x3D;&#x3D; null &amp;&amp; b &#x3D;&#x3D;&#x3D; null) return null;

    if(a &#x3D;&#x3D;&#x3D; null) return b;
    if(b &#x3D;&#x3D;&#x3D; null) return a;

    if(this.filter &#x3D;&#x3D;&#x3D; &quot;or&quot;)  return (a || b);
    if(this.filter &#x3D;&#x3D;&#x3D; &quot;and&quot;)  return (a &amp;&amp; b);
    if(this.filter &#x3D;&#x3D;&#x3D; &quot;neq&quot;)  return (a !&#x3D;&#x3D; b);
    if(this.filter &#x3D;&#x3D;&#x3D; &quot;inv&quot;)  return (!b);


  }

  public hasPoint(p:Point) : boolean{

      const endPosition &#x3D; {
        x: this.topleft.x + this.size.w,
        y: this.topleft.y + this.size.h,
      };

      if(p.x &lt; this.topleft.x || p.x &gt; endPosition.x) return false;
      if(p.y &lt; this.topleft.y || p.y &gt; endPosition.y) return false;

    
    return true;

  }


  public resolvePoint(p:Point) : Interlacement{
    
    let i &#x3D; Math.floor((p.y -this.topleft.y) / this.scale);
    let j &#x3D; Math.floor((p.x - this.topleft.x) / this.scale);

    if(i &lt; 0 || i &gt;&#x3D; this.draft.wefts) i &#x3D; -1;
    if(j &lt; 0 || j &gt;&#x3D; this.draft.warps) j &#x3D; -1;

    return {i: i, j:j};

  }


  //takes an absolute reference and returns boolean or null if its unset
  public resolveToValue(p:Point) : boolean{

    const coords &#x3D; this.resolvePoint(p);

    if(coords.i &lt; 0 || coords.j &lt; 0) return null; //this out of range

    if(!this.draft.pattern[coords.i][coords.j].isSet()) return null;
    
    return this.draft.pattern[coords.i][coords.j].isUp();
  
  }

  setNewDraft(bounds: any, temp: Draft) {
    
    this.size.w &#x3D; temp.warps * this.scale;
    this.size.h &#x3D; temp.wefts * this.scale;
    this.topleft &#x3D; bounds.topleft; //adjusts to the top left of the new bounding box
    this.draft &#x3D; temp;

  }

     

  drawDraft(draft: Draft) {

    console.log(&quot;drawing&quot;, draft, this.canvas, this.cx);
    
    // this.canvas.width &#x3D; this.size.w;
    // this.canvas.height &#x3D; this.size.h;

    for (let i &#x3D; 0; i &lt; draft.visibleRows.length; i++) {
      
      for (let j &#x3D; 0; j &lt; draft.warps; j++) {
        let row:number &#x3D; draft.visibleRows[i];
    
        let is_up &#x3D; draft.isUp(row,j);
        let is_set &#x3D; draft.isSet(row, j);
        if(is_set){
          this.cx.fillStyle &#x3D; (is_up) ?  &#x27;#000000&#x27; :  &#x27;#ffffff&#x27;;
          this.cx.fillRect(j*this.scale, i*this.scale, this.scale, this.scale);
        } else{
          this.cx.fillStyle &#x3D;  &#x27;#DDDDDD&#x27; ;
          this.cx.fillRect(j*this.scale, i*this.scale, this.scale, this.scale);
        }
 
      }
    }
  }


  snapToGrid(p: Point):Point{

    p.x &#x3D; Math.floor(p.x / this.scale) * this.scale;
    p.y &#x3D; Math.floor(p.y / this.scale) * this.scale;
    return p;

  }
  
  dragEnd($event: any) {
    this.moving &#x3D; false;
    this.counter &#x3D; 0;  
    this.onSubdraftDrop.emit({id: this.draft.id});
  }

  dragStart($event: any) {
    this.moving &#x3D; true;
    this.counter &#x3D; 0;  
    this.onSubdraftStart.emit({id: this.draft.id});
  }

  dragMove($event: any) {
    //position of pointer of the page
    const pointer &#x3D; $event.pointerPosition;
   
    const relative &#x3D; {
      x: pointer.x, 
      y: pointer.y - 64 //pointer position is relative to window, not this parent div.
    }

    const adj &#x3D; this.snapToGrid(relative);
    this.topleft &#x3D; adj;

    if(this.counter%1 &#x3D;&#x3D;&#x3D; 0){
      this.onSubdraftMove.emit({id: this.draft.id});
      this.counter &#x3D; 0;
    } 
    this.counter++;
  }


  designActionChange(e){
    console.log(e);

    switch(e){
      // case &#x27;copy&#x27;: this.copyEvent(e);
      // break;

      // case &#x27;duplicate&#x27;: this.duplicate(e, &#x27;original&#x27;);
      // break;

      case &#x27;toggle&#x27;: this.pasteEvent(&#x27;invert&#x27;);
      break;

      case &#x27;flip_x&#x27;: this.pasteEvent(&#x27;mirrorX&#x27;);
      break;

      case &#x27;flip_y&#x27;: this.pasteEvent(&#x27;mirrorY&#x27;);
      break;

      case &#x27;shift_left&#x27;: this.pasteEvent(&#x27;shiftLeft&#x27;);
      break;

      case &#x27;shift_up&#x27;: this.pasteEvent(&#x27;shiftUp&#x27;);
      break;

    }
  }

    fill(id) {
      var p &#x3D; this.patterns[id].pattern;
      console.log(p);
      //need a way to specify an area within the fill
      this.draft.fill(p, &#x27;original&#x27;);
      this.drawDraft(this.draft);

    }

    // copyEvent(e) {
    //   this.onCopy();
    // }

    clearEvent(b:boolean) {
     // this.onClear(b);
    }

    pasteEvent(type) {

      var p &#x3D; this.draft.pattern;
      console.log(&quot;paste event&quot;, type, p);

      if(type &#x3D;&#x3D;&#x3D; undefined) type &#x3D; &quot;original&quot;;

     this.draft.fill(p, type);
     this.drawDraft(this.draft);



    }
    
    /**
  //  * Tell the weave directive to fill selection with pattern.
  //  * @extends WeaveComponent
  //  * @param {Event} e - fill event from design component.
  //  * @returns {void}
  //  */
  // public onFill(e) {
    
  //   var p &#x3D; this.patterns[e.id].pattern;
  //   console.log(p);
    

  //   //need a way to specify an area within the fill
  //   this.draft.fill(p, &#x27;original&#x27;);
  //   this.drawDraft(this.draft);


  //   // if(this.render.showingFrames()) this.draft.recomputeLoom();

  //   // if(this.render.isYarnBasedView()) this.draft.computeYarnPaths();
    
  //   // this.palette.redraw({drawdown:true, loom:true});

  //   // this.timeline.addHistoryState(this.draft);
    
  // }

  /**
   * Tell weave reference to clear selection.
   * @extends WeaveComponent
   * @param {Event} Delte - clear event from design component.
   * @returns {void}
   */
  public onClear(b:boolean) {
    
    // this.draft.fillArea(this.palette.selection, [[b]], &#x27;original&#x27;)

    // this.palette.copyArea();

    // this.palette.redraw({drawdown:true, loom:true});

    // this.timeline.addHistoryState(this.draft);

  }

 
  /**
   * Tells weave reference to paste copied pattern.
   * @extends WeaveComponent
   * @param {Event} e - paste event from design component.
   * @returns {void}
   */
  public onPaste(e) {

     var p &#x3D; this.draft.pattern;
     var type;

    if(e.type &#x3D;&#x3D;&#x3D; undefined) type &#x3D; &quot;original&quot;;
    else type &#x3D;  e.type;

     this.draft.fill(p, type);
     this.drawDraft(this.draft);

    // if(this.render.showingFrames()) this.draft.recomputeLoom();
    
    // if(this.render.isYarnBasedView()) this.draft.computeYarnPaths();

    // this.timeline.addHistoryState(this.draft);

    // this.palette.copyArea();

    // this.palette.redraw({drawdown:true, loom:true, weft_materials: true, warp_materials:true, weft_systems:true, warp_systems:true});
 

  }




}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'Interlacement.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
